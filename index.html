<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AtkÃ¶y Spor Okulu - YÃ¶netim Sistemi</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles.css">
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="atkoy.jpeg">
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="screen active">
        <div class="container">
            <div class="login-mockup">
                <div class="logo" style="background: url('atkoy.jpeg') center/contain no-repeat;"></div>
                <div class="system-title">ATKÃ–Y SPOR OKULU YÃ–NETÄ°M SÄ°STEMÄ°</div>
                <form id="loginForm">
                    <div class="input-group">
                        <label><i class="fas fa-user"></i> KullanÄ±cÄ± AdÄ±</label>
                        <input type="text" id="username" required title="KullanÄ±cÄ± adÄ±nÄ±zÄ± girin" placeholder="KullanÄ±cÄ± adÄ±">
                    </div>
                    <div class="input-group">
                        <label><i class="fas fa-lock"></i> Åžifre</label>
                        <input type="password" id="password" required title="Åžifrenizi girin" placeholder="Åžifre">
                    </div>
                    <div class="remember-forgot">
                        <label style="display: flex; align-items: center; gap: 8px; margin: 0;">
                            <input type="checkbox" id="rememberMe"> Beni HatÄ±rla
                        </label>
                        <a href="#" class="forgot-password">Åžifremi Unuttum</a>
                    </div>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-sign-in-alt"></i> GÄ°RÄ°Åž YAP
                    </button>
                </form>
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; font-size: 12px; color: #6B7280;">
                    <i class="fas fa-info-circle"></i> Åžifre sÄ±fÄ±rlama kayÄ±tlÄ± e-posta adresinize gÃ¶nderilecektir.
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Screen -->
    <div id="dashboardScreen" class="screen">
        <div class="container">
            <header class="app-header">
                <div class="header-left">
                    <div class="logo-small" style="background: url('atkoy.jpeg') center/contain no-repeat;"></div>
                    <h1>AtkÃ¶y Spor Okulu</h1>
                </div>
                <div class="header-right">
                    <span class="user-info" id="userWelcome">HoÅŸ geldiniz, Admin</span>
                    <button id="logoutBtn" class="btn-logout">
                        <i class="fas fa-sign-out-alt"></i> Ã‡Ä±kÄ±ÅŸ
                    </button>
                </div>
            </header>

            <nav class="main-nav">
                <button class="nav-btn active" data-screen="dashboardScreen">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </button>
                <button class="nav-btn" data-screen="studentsScreen">
                    <i class="fas fa-users"></i> Ã–ÄŸrenciler
                </button>
                <button class="nav-btn" data-screen="equipmentScreen">
                    <i class="fas fa-tshirt"></i> Ekipman
                </button>
                <button class="nav-btn" data-screen="calendarScreen">
                    <i class="fas fa-calendar-alt"></i> Takvim
                </button>
                <button class="nav-btn" data-screen="paymentsScreen">
                    <i class="fas fa-credit-card"></i> Aidatlar
                </button>
                <button class="nav-btn" data-screen="settingsScreen" id="settingsNavBtn">
                    <i class="fas fa-cog"></i> Ayarlar
                </button>
            </nav>

            <main class="main-content">
                <h2 class="page-title">ðŸ“Š Dashboard</h2>
                
                <!-- Stats Cards -->
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-icon-wrapper">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="totalStudents">0</div>
                            <div class="stat-label">Toplam Ã–ÄŸrenci</div>
                            <div class="stat-change positive">+12% bu ay</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon-wrapper sport">
                            <i class="fas fa-running"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="totalSportBranches">0</div>
                            <div class="stat-label">Spor BranÅŸÄ±</div>
                            <div class="stat-change neutral">Aktif branÅŸlar</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon-wrapper payment">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="paymentRate">0%</div>
                            <div class="stat-label">Aidat OranÄ±</div>
                            <div class="stat-change positive">+5% geÃ§en ay</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon-wrapper training">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="monthlyTrainings">0</div>
                            <div class="stat-label">Bu Ay Antrenman</div>
                            <div class="stat-change neutral">Planlanan</div>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="dashboard-charts">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 id="studentDistributionTitle">Spor BranÅŸlarÄ±na GÃ¶re Ã–ÄŸrenci DaÄŸÄ±lÄ±mÄ±</h3>
                            <div class="chart-controls">
                                <button class="chart-btn active" data-chart="pie">BranÅŸ</button>
                                <button class="chart-btn" data-chart="gender">Cinsiyet</button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="studentDistributionChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>AylÄ±k Aidat Durumu</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="paymentsChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Recent Activities -->
                <div class="dashboard-activities">
                    <div class="activity-card">
                        <div class="activity-header">
                            <h3>Bu Haftaki Antrenmanlar</h3>
                            <span class="activity-count" id="weeklyTrainingsCount">0</span>
                        </div>
                        <div class="chart-container" style="height: 300px;">
                            <canvas id="weeklyTrainingsChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="activity-card">
                        <div class="activity-header">
                            <h3>Son Aktiviteler</h3>
                            <a href="#" class="view-all" onclick="app.showAllActivities(); return false;">TÃ¼mÃ¼nÃ¼ GÃ¶r</a>
                        </div>
                        <div class="activity-list" id="recentActivitiesList">
                            <!-- Activities will be loaded here -->
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Students Screen -->
    <div id="studentsScreen" class="screen">
        <div class="container">
            <header class="app-header">
                <div class="header-left">
                    <div class="logo-small" style="background: url('atkoy.jpeg') center/contain no-repeat;"></div>
                    <h1>AtkÃ¶y Spor Okulu</h1>
                </div>
                <div class="header-right">
                    <span class="user-info" id="userWelcome2">HoÅŸ geldiniz, Admin</span>
                    <button id="logoutBtn2" class="btn-logout" title="Sistemden Ã§Ä±kÄ±ÅŸ yap">
                        <i class="fas fa-sign-out-alt"></i> Ã‡Ä±kÄ±ÅŸ
                    </button>
                </div>
            </header>

            <nav class="main-nav">
                <button class="nav-btn" data-screen="dashboardScreen">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </button>
                <button class="nav-btn active" data-screen="studentsScreen">
                    <i class="fas fa-users"></i> Ã–ÄŸrenciler
                </button>
                <button class="nav-btn" data-screen="equipmentScreen">
                    <i class="fas fa-tshirt"></i> Ekipman
                </button>
                <button class="nav-btn" data-screen="calendarScreen">
                    <i class="fas fa-calendar-alt"></i> Takvim
                </button>
                <button class="nav-btn" data-screen="paymentsScreen">
                    <i class="fas fa-credit-card"></i> Aidatlar
                </button>
                <button class="nav-btn" data-screen="settingsScreen" id="settingsNavBtn">
                    <i class="fas fa-cog"></i> Ayarlar
                </button>
            </nav>

            <main class="main-content">
                <div class="page-header">
                    <h2 class="page-title">ðŸ‘¥ Ã–ÄŸrenciler</h2>
                    <button id="addStudentBtn" class="btn-primary">
                        <i class="fas fa-plus"></i> Ã–ÄŸrenci Ekle
                    </button>
                </div>

                <div id="studentTabs">
                    <!-- Dynamic sport tabs will be loaded here -->
                </div>

                <div class="students-container">
                    <div id="studentsList" class="students-list">
                        <!-- Students will be loaded here -->
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Equipment Screen -->
    <div id="equipmentScreen" class="screen">
        <div class="container">
            <header class="app-header">
                <div class="header-left">
                    <div class="logo-small" style="background: url('atkoy.jpeg') center/contain no-repeat;"></div>
                    <h1>AtkÃ¶y Spor Okulu</h1>
                </div>
                <div class="header-right">
                    <span class="user-info" id="userWelcome3">HoÅŸ geldiniz, Admin</span>
                    <button id="logoutBtn3" class="btn-logout" title="Sistemden Ã§Ä±kÄ±ÅŸ yap">
                        <i class="fas fa-sign-out-alt"></i> Ã‡Ä±kÄ±ÅŸ
                    </button>
                </div>
            </header>

            <nav class="main-nav">
                <button class="nav-btn" data-screen="dashboardScreen">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </button>
                <button class="nav-btn" data-screen="studentsScreen">
                    <i class="fas fa-users"></i> Ã–ÄŸrenciler
                </button>
                <button class="nav-btn active" data-screen="equipmentScreen">
                    <i class="fas fa-tshirt"></i> Ekipman
                </button>
                <button class="nav-btn" data-screen="calendarScreen">
                    <i class="fas fa-calendar-alt"></i> Takvim
                </button>
                <button class="nav-btn" data-screen="paymentsScreen">
                    <i class="fas fa-credit-card"></i> Aidatlar
                </button>
                <button class="nav-btn" data-screen="settingsScreen" id="settingsNavBtn">
                    <i class="fas fa-cog"></i> Ayarlar
                </button>
            </nav>

            <main class="main-content">
                <div id="equipmentContainer">
                    <!-- Equipment content will be loaded here -->
                </div>
            </main>
        </div>
    </div>

    <!-- Calendar Screen -->
    <div id="calendarScreen" class="screen">
        <div class="container">
            <header class="app-header">
                <div class="header-left">
                    <div class="logo-small" style="background: url('atkoy.jpeg') center/contain no-repeat;"></div>
                    <h1>AtkÃ¶y Spor Okulu</h1>
                </div>
                <div class="header-right">
                    <span class="user-info" id="userWelcome4">HoÅŸ geldiniz, Admin</span>
                    <button id="logoutBtn4" class="btn-logout" title="Sistemden Ã§Ä±kÄ±ÅŸ yap">
                        <i class="fas fa-sign-out-alt"></i> Ã‡Ä±kÄ±ÅŸ
                    </button>
                </div>
            </header>

            <nav class="main-nav">
                <button class="nav-btn" data-screen="dashboardScreen">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </button>
                <button class="nav-btn" data-screen="studentsScreen">
                    <i class="fas fa-users"></i> Ã–ÄŸrenciler
                </button>
                <button class="nav-btn" data-screen="equipmentScreen">
                    <i class="fas fa-tshirt"></i> Ekipman
                </button>
                <button class="nav-btn" data-screen="calendarScreen">
                    <i class="fas fa-calendar-alt"></i> Takvim
                </button>
                <button class="nav-btn" data-screen="paymentsScreen">
                    <i class="fas fa-credit-card"></i> Aidatlar
                </button>
                <button class="nav-btn" data-screen="settingsScreen" id="settingsNavBtn">
                    <i class="fas fa-cog"></i> Ayarlar
                </button>
            </nav>

            <main class="main-content">
                <div id="calendarContainer">
                    <!-- Calendar content will be loaded here -->
                </div>
            </main>
        </div>
    </div>

    <!-- Payments Screen -->
    <div id="paymentsScreen" class="screen">
        <div class="container">
            <header class="app-header">
                <div class="header-left">
                    <div class="logo-small" style="background: url('atkoy.jpeg') center/contain no-repeat;"></div>
                    <h1>AtkÃ¶y Spor Okulu</h1>
                </div>
                <div class="header-right">
                    <span class="user-info" id="userWelcome5">HoÅŸ geldiniz, Admin</span>
                    <button id="logoutBtn5" class="btn-logout" title="Sistemden Ã§Ä±kÄ±ÅŸ yap">
                        <i class="fas fa-sign-out-alt"></i> Ã‡Ä±kÄ±ÅŸ
                    </button>
                </div>
            </header>

            <nav class="main-nav">
                <button class="nav-btn" data-screen="dashboardScreen">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </button>
                <button class="nav-btn" data-screen="studentsScreen">
                    <i class="fas fa-users"></i> Ã–ÄŸrenciler
                </button>
                <button class="nav-btn" data-screen="equipmentScreen">
                    <i class="fas fa-tshirt"></i> Ekipman
                </button>
                <button class="nav-btn" data-screen="calendarScreen">
                    <i class="fas fa-calendar-alt"></i> Takvim
                </button>
                <button class="nav-btn active" data-screen="paymentsScreen">
                    <i class="fas fa-credit-card"></i> Aidatlar
                </button>
                <button class="nav-btn" data-screen="settingsScreen">
                    <i class="fas fa-cog"></i> Ayarlar
                </button>
            </nav>

            <main class="main-content">
                <div id="paymentsContainer">
                    <!-- Payments will be loaded here -->
                </div>
            </main>
        </div>
    </div>

    <!-- Training Modal -->
    <div id="trainingModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px; margin: 50px auto;">
            <div class="modal-header" style="background: #DC2626; color: white; padding: 20px; border-radius: 8px 8px 0 0; display: flex; justify-content: space-between; align-items: center;">
                <h2 style="margin: 0; font-size: 20px; font-weight: 600;">
                    <i class="fas fa-plus-circle" style="margin-right: 8px;"></i> Yeni Antrenman Ekle
                </h2>
                <button class="close-btn" onclick="app.hideTrainingModal()" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">&times;</button>
            </div>
            <form id="trainingForm" onsubmit="app.handleTrainingFormSubmit(event); return false;" style="padding: 25px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <label style="display: flex; align-items: center; font-weight: 500; color: #374151; margin-bottom: 8px;">
                            <i class="fas fa-running" style="margin-right: 8px; color: #DC2626;"></i> BranÅŸ
                        </label>
                        <select id="trainingSport" required onchange="app.loadTrainingAgeGroups()" style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 14px; background: white;">
                            <option value="">BranÅŸ SeÃ§in</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: flex; align-items: center; font-weight: 500; color: #374151; margin-bottom: 8px;">
                            <i class="fas fa-users" style="margin-right: 8px; color: #DC2626;"></i> YaÅŸ Grubu
                        </label>
                        <select id="trainingAgeGroup" required style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 14px; background: white;">
                            <option value="">Ã–nce branÅŸ seÃ§in</option>
                        </select>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <label style="display: flex; align-items: center; font-weight: 500; color: #374151; margin-bottom: 8px;">
                            <i class="fas fa-calendar" style="margin-right: 8px; color: #DC2626;"></i> Tarih
                        </label>
                        <input type="date" id="trainingDate" required style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 14px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-weight: 500;">
                    </div>
                    <div>
                        <label style="display: flex; align-items: center; font-weight: 500; color: #374151; margin-bottom: 8px;">
                            <i class="fas fa-clock" style="margin-right: 8px; color: #DC2626;"></i> BaÅŸlangÄ±Ã§ Saati
                        </label>
                        <input type="time" id="trainingStartTime" required style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 14px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-weight: 500;">
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <label style="display: flex; align-items: center; font-weight: 500; color: #374151; margin-bottom: 8px;">
                            <i class="fas fa-clock" style="margin-right: 8px; color: #DC2626;"></i> BitiÅŸ Saati
                        </label>
                        <input type="time" id="trainingEndTime" required style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 14px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-weight: 500;">
                    </div>
                    <div>
                        <label style="display: flex; align-items: center; font-weight: 500; color: #374151; margin-bottom: 8px;">
                            <i class="fas fa-map-marker-alt" style="margin-right: 8px; color: #DC2626;"></i> Saha/Salon
                        </label>
                        <input type="text" id="trainingLocation" placeholder="Saha/Salon adÄ±" required style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: flex; align-items: center; font-weight: 500; color: #374151; margin-bottom: 8px;">
                        <i class="fas fa-user" style="margin-right: 8px; color: #DC2626;"></i> AntrenÃ¶r
                    </label>
                    <input type="text" id="trainingCoach" placeholder="AntrenÃ¶r adÄ±" required style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                </div>
                
                <div style="margin-bottom: 30px;">
                    <label style="display: flex; align-items: center; font-weight: 500; color: #374151; margin-bottom: 8px;">
                        <i class="fas fa-sticky-note" style="margin-right: 8px; color: #DC2626;"></i> Antrenman Ä°Ã§eriÄŸi
                    </label>
                    <textarea id="trainingContent" rows="4" placeholder="Antrenman detaylarÄ± ve iÃ§eriÄŸi" style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 14px; resize: vertical; font-family: inherit;"></textarea>
                </div>
                
                <div style="display: flex; justify-content: flex-end; gap: 12px; padding-top: 20px; border-top: 1px solid #E5E7EB;">
                    <button type="button" onclick="app.hideTrainingModal()" style="background: #6B7280; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-times"></i> Ä°ptal
                    </button>
                    <button type="submit" style="background: #DC2626; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-save"></i> Kaydet
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Training Attendance Modal -->
    <div id="attendanceModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 700px; margin: 50px auto;">
            <div class="modal-header" style="background: #DC2626; color: white; padding: 20px; border-radius: 8px 8px 0 0; display: flex; justify-content: space-between; align-items: center;">
                <h2 style="margin: 0; font-size: 20px; font-weight: 600;">
                    <i class="fas fa-user-check" style="margin-right: 8px;"></i> Antrenman KatÄ±lÄ±m Takibi
                </h2>
                <button class="close-btn" onclick="app.hideAttendanceModal()" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">&times;</button>
            </div>
            <div id="attendanceContent" style="padding: 25px;">
                <div class="training-info" style="background: #F8FAFC; padding: 16px; border-radius: 8px; margin-bottom: 25px; border-left: 4px solid #DC2626;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                        <i class="fas fa-running" style="color: #DC2626; font-size: 18px;"></i>
                        <h3 id="attendanceTrainingInfo" style="margin: 0; color: #374151; font-size: 18px; font-weight: 600;"></h3>
                    </div>
                    <p id="attendanceTrainingDetails" style="margin: 0; color: #6B7280; font-size: 14px;"></p>
                </div>
                
                <div class="attendance-list" id="attendanceList" style="max-height: 400px; overflow-y: auto;">
                    <!-- Ã–ÄŸrenci katÄ±lÄ±m listesi buraya yÃ¼klenecek -->
                </div>
                
                <div style="display: flex; justify-content: space-between; gap: 12px; padding-top: 20px; border-top: 1px solid #E5E7EB;">
                    <button type="button" onclick="app.hideAttendanceModal()" style="background: #6B7280; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-times"></i> Kapat
                    </button>
                    <div style="display: flex; gap: 12px;">
                        <button type="button" onclick="app.editTrainingFromAttendance()" style="background: #F59E0B; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-edit"></i> AntrenmanÄ± DÃ¼zenle
                        </button>
                        <button type="button" onclick="app.saveAttendance()" style="background: #DC2626; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-save"></i> KatÄ±lÄ±mlarÄ± Kaydet
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Training Edit Modal -->
    <div id="trainingEditModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px; margin: 50px auto;">
            <div class="modal-header" style="background: #DC2626; color: white; padding: 20px; border-radius: 8px 8px 0 0; display: flex; justify-content: space-between; align-items: center;">
                <h2 style="margin: 0; font-size: 20px; font-weight: 600;">
                    <i class="fas fa-edit" style="margin-right: 8px;"></i> Antrenman DÃ¼zenle
                </h2>
                <button class="close-btn" onclick="app.hideTrainingEditModal()" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">&times;</button>
            </div>
            <form id="trainingEditForm" style="padding: 25px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">
                            <i class="fas fa-running" style="margin-right: 5px;"></i> BranÅŸ
                        </label>
                        <select id="editTrainingSport" required style="width: 100%; padding: 12px; border: 1px solid #D1D5DB; border-radius: 8px; font-size: 14px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-weight: 500;">
                            <option value="">BranÅŸ SeÃ§in</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">
                            <i class="fas fa-users" style="margin-right: 5px;"></i> YaÅŸ Grubu
                        </label>
                        <select id="editTrainingAgeGroup" required style="width: 100%; padding: 12px; border: 1px solid #D1D5DB; border-radius: 8px; font-size: 14px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-weight: 500;">
                            <option value="">YaÅŸ grubu seÃ§in</option>
                        </select>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">
                            <i class="fas fa-calendar-alt" style="margin-right: 5px;"></i> Tarih
                        </label>
                        <input type="date" id="editTrainingDate" required style="width: 100%; padding: 12px; border: 1px solid #D1D5DB; border-radius: 8px; font-size: 14px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-weight: 500;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">
                            <i class="fas fa-clock" style="margin-right: 5px;"></i> BaÅŸlangÄ±Ã§ Saati
                        </label>
                        <input type="time" id="editTrainingStartTime" required style="width: 100%; padding: 12px; border: 1px solid #D1D5DB; border-radius: 8px; font-size: 14px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-weight: 500;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">
                            <i class="fas fa-clock" style="margin-right: 5px;"></i> BitiÅŸ Saati
                        </label>
                        <input type="time" id="editTrainingEndTime" required style="width: 100%; padding: 12px; border: 1px solid #D1D5DB; border-radius: 8px; font-size: 14px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-weight: 500;">
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">
                            <i class="fas fa-map-marker-alt" style="margin-right: 5px;"></i> Saha/Salon
                        </label>
                        <input type="text" id="editTrainingLocation" placeholder="Korner HalÄ± Saha" style="width: 100%; padding: 12px; border: 1px solid #D1D5DB; border-radius: 8px; font-size: 14px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">
                            <i class="fas fa-user-tie" style="margin-right: 5px;"></i> AntrenÃ¶r
                        </label>
                        <input type="text" id="editTrainingInstructor" placeholder="Serhat Karabulut" style="width: 100%; padding: 12px; border: 1px solid #D1D5DB; border-radius: 8px; font-size: 14px;">
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">
                        <i class="fas fa-sticky-note" style="margin-right: 5px;"></i> Antrenman Ä°Ã§eriÄŸi
                    </label>
                    <textarea id="editTrainingNotes" rows="4" placeholder="Kondisyon" style="width: 100%; padding: 12px; border: 1px solid #D1D5DB; border-radius: 8px; font-size: 14px; resize: vertical;"></textarea>
                </div>

                <div style="display: flex; justify-content: space-between; gap: 12px; padding-top: 20px; border-top: 1px solid #E5E7EB;">
                    <button type="button" onclick="app.hideTrainingEditModal()" style="background: #6B7280; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-times"></i> Ä°ptal
                    </button>
                    <div style="display: flex; gap: 12px;">
                        <button type="button" onclick="app.deleteTraining()" style="background: #EF4444; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-trash"></i> Sil
                        </button>
                        <button type="button" onclick="app.updateTraining()" style="background: #DC2626; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-save"></i> GÃ¼ncelle
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Payments Screen -->
    <div id="paymentsScreen" class="screen">
        <div class="container">
            <header class="app-header">
                <div class="header-left">
                    <div class="logo-small" style="background: url('atkoy.jpeg') center/contain no-repeat;"></div>
                    <h1>AtkÃ¶y Spor Okulu</h1>
                </div>
                <div class="header-right">
                    <span class="user-info" id="userWelcome7">HoÅŸ geldiniz, Admin</span>
                    <button id="logoutBtn6" class="btn-logout" title="Sistemden Ã§Ä±kÄ±ÅŸ yap">
                        <i class="fas fa-sign-out-alt"></i> Ã‡Ä±kÄ±ÅŸ
                    </button>
                </div>
            </header>

            <nav class="main-nav">
                <button class="nav-btn" data-screen="dashboardScreen">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </button>
                <button class="nav-btn" data-screen="studentsScreen">
                    <i class="fas fa-users"></i> Ã–ÄŸrenciler
                </button>
                <button class="nav-btn" data-screen="equipmentScreen">
                    <i class="fas fa-tshirt"></i> Ekipman
                </button>
                <button class="nav-btn" data-screen="calendarScreen">
                    <i class="fas fa-calendar-alt"></i> Takvim
                </button>
                <button class="nav-btn" data-screen="paymentsScreen">
                    <i class="fas fa-credit-card"></i> Aidatlar
                </button>
                <button class="nav-btn" data-screen="settingsScreen" id="settingsNavBtn">
                    <i class="fas fa-cog"></i> Ayarlar
                </button>
            </nav>

            <main class="main-content">
                <h2 class="page-title">ðŸ’³ Aidat Takip Sistemi</h2>
                <div id="paymentsContainer">
                    <!-- Payments content will be loaded here -->
                </div>
            </main>
        </div>
    </div>

    <!-- Settings Screen -->
    <div id="settingsScreen" class="screen">
        <div class="container">
            <header class="app-header">
                <div class="header-left">
                    <div class="logo-small" style="background: url('atkoy.jpeg') center/contain no-repeat;"></div>
                    <h1>AtkÃ¶y Spor Okulu</h1>
                </div>
                <div class="header-right">
                    <span class="user-info" id="userWelcome6">HoÅŸ geldiniz, Admin</span>
                    <button id="logoutBtn6" class="btn-logout" title="Sistemden Ã§Ä±kÄ±ÅŸ yap">
                        <i class="fas fa-sign-out-alt"></i> Ã‡Ä±kÄ±ÅŸ
                    </button>
                </div>
            </header>

            <nav class="main-nav">
                <button class="nav-btn" data-screen="dashboardScreen">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </button>
                <button class="nav-btn" data-screen="studentsScreen">
                    <i class="fas fa-users"></i> Ã–ÄŸrenciler
                </button>
                <button class="nav-btn" data-screen="equipmentScreen">
                    <i class="fas fa-tshirt"></i> Ekipman
                </button>
                <button class="nav-btn" data-screen="calendarScreen">
                    <i class="fas fa-calendar-alt"></i> Takvim
                </button>
                <button class="nav-btn" data-screen="paymentsScreen">
                    <i class="fas fa-credit-card"></i> Aidatlar
                </button>
                <button class="nav-btn" data-screen="settingsScreen" id="settingsNavBtn">
                    <i class="fas fa-cog"></i> Ayarlar
                </button>
            </nav>

            <main class="main-content">
                <!-- Settings Header with Red Line -->
                <div style="display: flex; align-items: center; padding: 15px 0; border-bottom: 3px solid #dc2626; margin-bottom: 25px;">
                    <i class="fas fa-cog" style="color: #dc2626; font-size: 18px; margin-right: 10px;"></i>
                    <h1 style="margin: 0; color: #dc2626; font-size: 22px; font-weight: 600;">Sistem AyarlarÄ±</h1>
                </div>

                <!-- Settings Tabs -->
                <div style="display: flex; gap: 8px; margin-bottom: 25px; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); padding: 8px; border-radius: 16px; box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06); border: 1px solid #e2e8f0; flex-wrap: wrap;">
                    <button class="settings-tab-btn active" data-tab="branches" style="
                        padding: 12px 24px;
                        background: linear-gradient(135deg, #DC2626 0%, #B91C1C 100%);
                        color: white;
                        border: 1px solid #B91C1C;
                        border-radius: 12px;
                        cursor: pointer;
                        font-weight: 600;
                        font-size: 14px;
                        transition: all 0.3s;
                        box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4);
                        white-space: nowrap;
                    ">
                        Spor BranÅŸlarÄ±
                    </button>
                    <button class="settings-tab-btn" data-tab="equipment" style="
                    padding: 12px 24px;
                    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
                    color: #475569;
                    border: 1px solid #e2e8f0;
                    border-radius: 12px;
                    cursor: pointer;
                    font-weight: 600;
                    font-size: 14px;
                    transition: all 0.3s;
                    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                    white-space: nowrap;
                ">
                    Ekipman TÃ¼rleri
                </button>
                <button class="settings-tab-btn" data-tab="users" style="
                padding: 12px 24px;
                background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
                color: #475569;
                border: 1px solid #e2e8f0;
                border-radius: 12px;
                cursor: pointer;
                font-weight: 600;
                font-size: 14px;
                transition: all 0.3s;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                white-space: nowrap;
            ">
                KullanÄ±cÄ±lar
            </button>
            <button class="settings-tab-btn" data-tab="systemlogs" style="
            padding: 12px 24px;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            color: #475569;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            white-space: nowrap;
        ">
            Sistem LoglarÄ±
        </button>
        <button class="settings-tab-btn" data-tab="datamanagement" style="
        padding: 12px 24px;
        background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        color: #475569;
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.3s;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        white-space: nowrap;
    ">
        Veri YÃ¶netimi
    </button>
                    </div>

                    <!-- Tab Content Container -->
                    <div style="border: 1px solid #d1d5db; border-top: none; background: white; min-height: 450px;">
                        
                        <!-- Sport Branches Tab -->
                        <div id="branchesTabContent" class="settings-tab-content active" style="padding: 25px;">
                            <div style="margin-bottom: 25px;">
                                <h2 style="margin: 0; color: #1f2937; font-size: 16px; font-weight: 600;">Spor BranÅŸlarÄ±</h2>
                            </div>

                            <!-- Sport Branch Definition Form -->
                            <div style="margin-bottom: 35px;">
                                <div style="display: flex; align-items: center; margin-bottom: 25px; padding-bottom: 12px; border-bottom: 2px solid #f1f5f9;">
                                    <div style="background: linear-gradient(135deg, #dc2626, #b91c1c); padding: 8px; border-radius: 8px; margin-right: 12px; box-shadow: 0 2px 8px rgba(220, 38, 38, 0.2);">
                                        <i class="fas fa-running" style="color: white; font-size: 14px;"></i>
                                    </div>
                                    <h3 style="margin: 0; color: #1f2937; font-size: 16px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">SPOR BRANÅžI TANIMLAMA</h3>
                                </div>

                                <div style="background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border: 1px solid #e2e8f0; border-radius: 12px; padding: 30px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); position: relative; overflow: hidden;">
                                    <!-- Decorative background element -->
                                    <div style="position: absolute; top: -20px; right: -20px; width: 100px; height: 100px; background: linear-gradient(135deg, #dc2626, #b91c1c); opacity: 0.05; border-radius: 50%; transform: rotate(45deg);"></div>
                                    
                                    <form id="branchForm" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; position: relative; z-index: 1;">
                                        <input type="hidden" id="editingBranchId" value="">
                                        <div>
                                            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.3px;">BranÅŸ AdÄ±</label>
                                            <input type="text" id="branchName" placeholder="Ã–rn: Futbol" style="
                                                width: 100%; 
                                                padding: 14px 16px; 
                                                border: 2px solid #e2e8f0; 
                                                border-radius: 8px; 
                                                font-size: 14px; 
                                                background: white;
                                                transition: all 0.3s ease;
                                                font-weight: 500;
                                            " onfocus="this.style.borderColor='#dc2626'; this.style.boxShadow='0 0 0 3px rgba(220, 38, 38, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                                        </div>
                                        <div>
                                            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.3px;">Kontenjan</label>
                                            <input type="number" id="branchCapacity" placeholder="Ã–rn: 25" style="
                                                width: 100%; 
                                                padding: 14px 16px; 
                                                border: 2px solid #e2e8f0; 
                                                border-radius: 8px; 
                                                font-size: 14px; 
                                                background: white;
                                                transition: all 0.3s ease;
                                                font-weight: 500;
                                            " onfocus="this.style.borderColor='#dc2626'; this.style.boxShadow='0 0 0 3px rgba(220, 38, 38, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                                        </div>
                                        <div>
                                            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.3px;">YaÅŸ Grubu</label>
                                            <input type="text" id="branchAgeGroup" placeholder="Ã–rn: 6-16 yaÅŸ" style="
                                                width: 100%; 
                                                padding: 14px 16px; 
                                                border: 2px solid #e2e8f0; 
                                                border-radius: 8px; 
                                                font-size: 14px; 
                                                background: white;
                                                transition: all 0.3s ease;
                                                font-weight: 500;
                                            " onfocus="this.style.borderColor='#dc2626'; this.style.boxShadow='0 0 0 3px rgba(220, 38, 38, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                                        </div>
                                        <div>
                                            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.3px;">Aidat Ãœcreti (â‚º)</label>
                                            <input type="number" id="branchFee" placeholder="Ã–rn: 300" style="
                                                width: 100%; 
                                                padding: 14px 16px; 
                                                border: 2px solid #e2e8f0; 
                                                border-radius: 8px; 
                                                font-size: 14px; 
                                                background: white;
                                                transition: all 0.3s ease;
                                                font-weight: 500;
                                            " onfocus="this.style.borderColor='#dc2626'; this.style.boxShadow='0 0 0 3px rgba(220, 38, 38, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                                        </div>
                                        <div>
                                            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.3px;">BaÅŸlama Tarihi</label>
                                            <input type="date" id="branchStartDate" placeholder="gg.aa.yyyy" style="
                                                width: 100%; 
                                                padding: 14px 16px; 
                                                border: 2px solid #e2e8f0; 
                                                border-radius: 8px; 
                                                font-size: 14px; 
                                                background: white;
                                                transition: all 0.3s ease;
                                                font-weight: 500;
                                            " onfocus="this.style.borderColor='#dc2626'; this.style.boxShadow='0 0 0 3px rgba(220, 38, 38, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                                        </div>
                                        <div>
                                            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.3px;">BitiÅŸ Tarihi</label>
                                            <input type="date" id="branchEndDate" placeholder="gg.aa.yyyy" style="
                                                width: 100%; 
                                                padding: 14px 16px; 
                                                border: 2px solid #e2e8f0; 
                                                border-radius: 8px; 
                                                font-size: 14px; 
                                                background: white;
                                                transition: all 0.3s ease;
                                                font-weight: 500;
                                            " onfocus="this.style.borderColor='#dc2626'; this.style.boxShadow='0 0 0 3px rgba(220, 38, 38, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                                        </div>
                                    </form>
                                    <div style="margin-top: 30px; display: flex; justify-content: flex-start;">
                                        <button onclick="saveBranch()" style="
                                            background: linear-gradient(135deg, #dc2626, #b91c1c); 
                                            color: white; 
                                            border: none; 
                                            padding: 14px 28px; 
                                            border-radius: 8px; 
                                            font-weight: 600; 
                                            cursor: pointer; 
                                            font-size: 14px; 
                                            display: flex; 
                                            align-items: center; 
                                            gap: 8px;
                                            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
                                            transition: all 0.3s ease;
                                            text-transform: uppercase;
                                            letter-spacing: 0.5px;
                                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(220, 38, 38, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(220, 38, 38, 0.3)'">
                                            <i class="fas fa-save" style="font-size: 12px;"></i>
                                            Kaydet
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Mevcut Spor BranÅŸlarÄ± Header -->
                            <div style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); border-radius: 12px 12px 0 0; padding: 16px 25px; margin-bottom: 0; box-shadow: 0 2px 10px rgba(99, 102, 241, 0.2);">
                                <div style="display: flex; align-items: center;">
                                    <div style="background: rgba(255, 255, 255, 0.2); padding: 6px; border-radius: 6px; margin-right: 10px;">
                                        <i class="fas fa-list" style="color: white; font-size: 14px;"></i>
                                    </div>
                                    <h4 style="margin: 0; color: white; font-size: 15px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Mevcut Spor BranÅŸlarÄ±</h4>
                                </div>
                            </div>

                            <!-- Branches List -->
                            <div id="branchesList" style="background: white; border: 1px solid #e2e8f0; border-top: none; border-radius: 0 0 12px 12px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); overflow: hidden;">
                                <!-- Table Header -->
                                <div style="background: #f8fafc; padding: 16px 25px; border-bottom: 1px solid #e2e8f0; display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr 120px; gap: 20px; align-items: center;">
                                    <div style="font-weight: 700; color: #374151; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">BranÅŸ</div>
                                    <div style="font-weight: 700; color: #374151; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Kontenjan</div>
                                    <div style="font-weight: 700; color: #374151; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">YaÅŸ Grubu</div>
                                    <div style="font-weight: 700; color: #374151; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Ãœcret</div>
                                    <div style="font-weight: 700; color: #374151; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">BaÅŸlama</div>
                                    <div style="font-weight: 700; color: #374151; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">BitiÅŸ</div>
                                    <div style="font-weight: 700; color: #374151; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; text-align: center;">Ä°ÅŸlemler</div>
                                </div>

                                <!-- Dynamic content will be loaded here -->
                                <div id="branchesTableBody">
                                    <div style="padding: 40px; text-align: center; color: #6b7280;">
                                        <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 10px;"></i>
                                        <p>Spor branÅŸlarÄ± yÃ¼kleniyor...</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Equipment Tab -->
                        <div id="equipmentTabContent" class="settings-tab-content" style="display: none; padding: 25px;">
                            <div style="margin-bottom: 25px;">
                                <h2 style="margin: 0; color: #1f2937; font-size: 16px; font-weight: 600;">Ekipman TÃ¼rleri</h2>
                            </div>

                            <!-- Equipment Definition Form -->
                            <div style="margin-bottom: 35px;">
                                <div style="display: flex; align-items: center; margin-bottom: 25px; padding-bottom: 12px; border-bottom: 2px solid #f1f5f9;">
                                    <div style="background: linear-gradient(135deg, #dc2626, #b91c1c); padding: 8px; border-radius: 8px; margin-right: 12px; box-shadow: 0 2px 8px rgba(220, 38, 38, 0.2);">
                                        <i class="fas fa-tshirt" style="color: white; font-size: 14px;"></i>
                                    </div>
                                    <h3 style="margin: 0; color: #1f2937; font-size: 16px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">EKIPMAN TANIMLAMA</h3>
                                </div>

                                <div style="background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border: 1px solid #e2e8f0; border-radius: 12px; padding: 30px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); position: relative; overflow: hidden;">
                                    <!-- Decorative background element -->
                                    <div style="position: absolute; top: -20px; right: -20px; width: 100px; height: 100px; background: linear-gradient(135deg, #dc2626, #b91c1c); opacity: 0.05; border-radius: 50%; transform: rotate(45deg);"></div>
                                    
                                    <form id="equipmentForm" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; position: relative; z-index: 1;">
                                        <input type="hidden" id="editingEquipmentId" value="">
                                        <div>
                                            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.3px;">FotoÄŸraf YÃ¼kle</label>
                                            <input type="file" id="equipmentPhoto" accept="image/*" style="
                                                width: 100%; 
                                                padding: 14px 16px; 
                                                border: 2px solid #e2e8f0; 
                                                border-radius: 8px; 
                                                font-size: 14px; 
                                                background: white;
                                                transition: all 0.3s ease;
                                                font-weight: 500;
                                            " onfocus="this.style.borderColor='#dc2626'; this.style.boxShadow='0 0 0 3px rgba(220, 38, 38, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                                        </div>
                                        <div>
                                            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.3px;">Ekipman AdÄ±</label>
                                            <input type="text" id="equipmentName" placeholder="Ã–rn: Futbol FormasÄ±" style="
                                                width: 100%; 
                                                padding: 14px 16px; 
                                                border: 2px solid #e2e8f0; 
                                                border-radius: 8px; 
                                                font-size: 14px; 
                                                background: white;
                                                transition: all 0.3s ease;
                                                font-weight: 500;
                                            " onfocus="this.style.borderColor='#dc2626'; this.style.boxShadow='0 0 0 3px rgba(220, 38, 38, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                                        </div>
                                        <!-- Beden ve Miktar alanlarÄ± kaldÄ±rÄ±ldÄ±: Stok yÃ¶netimi 'Stok Ekle' modalÄ± ile yapÄ±lacak -->
                                        
                                        <div>
                                            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.3px;">Ãœcret (â‚º)</label>
                                            <input type="number" step="0.01" id="equipmentFee" placeholder="Ã–rn: 500" style="
                                                width: 100%; 
                                                padding: 14px 16px; 
                                                border: 2px solid #e2e8f0; 
                                                border-radius: 8px; 
                                                font-size: 14px; 
                                                background: white;
                                                transition: all 0.3s ease;
                                                font-weight: 500;
                                            " onfocus="this.style.borderColor='#dc2626'; this.style.boxShadow='0 0 0 3px rgba(220, 38, 38, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                                        </div>
                                    </form>
                                    <div style="margin-top: 30px; display: flex; justify-content: flex-start;">
                                        <button onclick="saveEquipment()" style="
                                            background: linear-gradient(135deg, #dc2626, #b91c1c); 
                                            color: white; 
                                            border: none; 
                                            padding: 14px 28px; 
                                            border-radius: 8px; 
                                            font-weight: 600; 
                                            cursor: pointer; 
                                            font-size: 14px; 
                                            display: flex; 
                                            align-items: center; 
                                            gap: 8px;
                                            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
                                            transition: all 0.3s ease;
                                            text-transform: uppercase;
                                            letter-spacing: 0.5px;
                                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(220, 38, 38, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(220, 38, 38, 0.3)'">
                                            <i class="fas fa-save" style="font-size: 12px;"></i>
                                            Kaydet
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Mevcut Ekipman TÃ¼rleri Header -->
                            <div style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); border-radius: 12px 12px 0 0; padding: 16px 25px; margin-bottom: 0; box-shadow: 0 2px 10px rgba(99, 102, 241, 0.2);">
                                <div style="display: flex; align-items: center;">
                                    <div style="background: rgba(255, 255, 255, 0.2); padding: 6px; border-radius: 6px; margin-right: 10px;">
                                        <i class="fas fa-list" style="color: white; font-size: 14px;"></i>
                                    </div>
                                    <h4 style="margin: 0; color: white; font-size: 15px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Mevcut Ekipman TÃ¼rleri</h4>
                                </div>
                            </div>

                            <!-- Equipment List -->
                            <div id="equipmentList" style="background: white; border: 1px solid #e2e8f0; border-top: none; border-radius: 0 0 12px 12px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); overflow: hidden;">
                                <!-- Table Header -->
                                <div style="background: #f8fafc; padding: 16px 25px; border-bottom: 1px solid #e2e8f0; display: grid; grid-template-columns: 80px 2fr 1fr 1fr 1fr 1fr 120px; gap: 20px; align-items: center;">
                                    <div style="font-weight: 700; color: #374151; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">FotoÄŸraf</div>
                                    <div style="font-weight: 700; color: #374151; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Ekipman</div>
                                    <div style="font-weight: 700; color: #374151; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Beden/Numara</div>
                                    <div style="font-weight: 700; color: #374151; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Miktar</div>
                                    <div style="font-weight: 700; color: #374151; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Ãœcret</div>
                                    <div style="font-weight: 700; color: #374151; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Eklenme</div>
                                    <div style="font-weight: 700; color: #374151; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; text-align: center;">Ä°ÅŸlemler</div>
                                </div>

                                <!-- Dynamic content will be loaded here -->
                                <div id="equipmentTableBody">
                                    <div style="padding: 40px; text-align: center; color: #6b7280;">
                                        <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 10px;"></i>
                                        <p>Ekipman tÃ¼rleri yÃ¼kleniyor...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Users Tab -->
                        <div id="usersTabContent" class="settings-tab-content" style="display: none; padding: 25px;">
                            <div style="margin-bottom: 25px;">
                                <h2 style="margin: 0; color: #1f2937; font-size: 16px; font-weight: 600;">KullanÄ±cÄ±lar</h2>
                            </div>

                            <!-- User Definition Form -->
                            <div style="margin-bottom: 35px;">
                                <div style="display: flex; align-items: center; margin-bottom: 25px; padding-bottom: 12px; border-bottom: 2px solid #f1f5f9;">
                                    <div style="background: linear-gradient(135deg, #dc2626, #b91c1c); padding: 8px; border-radius: 8px; margin-right: 12px; box-shadow: 0 2px 8px rgba(220, 38, 38, 0.2);">
                                        <i class="fas fa-user-plus" style="color: white; font-size: 14px;"></i>
                                    </div>
                                    <h3 style="margin: 0; color: #1f2937; font-size: 16px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">KULLANICI/ANTRENÃ–R TANIMLAMA</h3>
                                </div>

                                <div style="background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border: 1px solid #e2e8f0; border-radius: 12px; padding: 30px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); position: relative; overflow: hidden;">
                                    <!-- Decorative background element -->
                                    <div style="position: absolute; top: -20px; right: -20px; width: 100px; height: 100px; background: linear-gradient(135deg, #dc2626, #b91c1c); opacity: 0.05; border-radius: 50%; transform: rotate(45deg);"></div>
                                    
                                    <form id="userForm" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; position: relative; z-index: 1;">
                                        <input type="hidden" id="editingUserId" value="">
                                        <div>
                                            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.3px;">FotoÄŸraf</label>
                                            <input type="file" id="userPhoto" accept="image/*" style="
                                                width: 100%; 
                                                padding: 14px 16px; 
                                                border: 2px solid #e2e8f0; 
                                                border-radius: 8px; 
                                                font-size: 14px; 
                                                background: white;
                                                transition: all 0.3s ease;
                                                font-weight: 500;
                                            " onfocus="this.style.borderColor='#dc2626'; this.style.boxShadow='0 0 0 3px rgba(220, 38, 38, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                                        </div>
                                        <div>
                                            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.3px;">TC Kimlik No</label>
                                            <input type="text" id="userTcNo" placeholder="11 haneli TC kimlik numarasÄ±" maxlength="11" style="
                                                width: 100%; 
                                                padding: 14px 16px; 
                                                border: 2px solid #e2e8f0; 
                                                border-radius: 8px; 
                                                font-size: 14px; 
                                                background: white;
                                                transition: all 0.3s ease;
                                                font-weight: 500;
                                            " onfocus="this.style.borderColor='#dc2626'; this.style.boxShadow='0 0 0 3px rgba(220, 38, 38, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                                        </div>
                                        <div>
                                            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.3px;">Ad Soyad</label>
                                            <input type="text" id="userFullName" placeholder="Ä°sim Soyisim" style="
                                                width: 100%; 
                                                padding: 14px 16px; 
                                                border: 2px solid #e2e8f0; 
                                                border-radius: 8px; 
                                                font-size: 14px; 
                                                background: white;
                                                transition: all 0.3s ease;
                                                font-weight: 500;
                                            " onfocus="this.style.borderColor='#dc2626'; this.style.boxShadow='0 0 0 3px rgba(220, 38, 38, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                                        </div>
                                        <div>
                                            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.3px;">DoÄŸum Tarihi</label>
                                            <input type="date" id="userBirthDate" style="
                                                width: 100%; 
                                                padding: 14px 16px; 
                                                border: 2px solid #e2e8f0; 
                                                border-radius: 8px; 
                                                font-size: 14px; 
                                                background: white;
                                                transition: all 0.3s ease;
                                                font-weight: 500;
                                            " onfocus="this.style.borderColor='#dc2626'; this.style.boxShadow='0 0 0 3px rgba(220, 38, 38, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                                        </div>
                                        <div>
                                            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.3px;">Telefon</label>
                                            <input type="tel" id="userPhone" placeholder="0555 555 55 55" style="
                                                width: 100%; 
                                                padding: 14px 16px; 
                                                border: 2px solid #e2e8f0; 
                                                border-radius: 8px; 
                                                font-size: 14px; 
                                                background: white;
                                                transition: all 0.3s ease;
                                                font-weight: 500;
                                            " onfocus="this.style.borderColor='#dc2626'; this.style.boxShadow='0 0 0 3px rgba(220, 38, 38, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                                        </div>
                                        <div>
                                            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.3px;">E-posta</label>
                                            <input type="email" id="userEmail" placeholder="kullanici@email.com" style="
                                                width: 100%; 
                                                padding: 14px 16px; 
                                                border: 2px solid #e2e8f0; 
                                                border-radius: 8px; 
                                                font-size: 14px; 
                                                background: white;
                                                transition: all 0.3s ease;
                                                font-weight: 500;
                                            " onfocus="this.style.borderColor='#dc2626'; this.style.boxShadow='0 0 0 3px rgba(220, 38, 38, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                                        </div>
                                        <div>
                                            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.3px;">BranÅŸ</label>
                                            <select id="userBranch" style="
                                                width: 100%; 
                                                padding: 14px 16px; 
                                                border: 2px solid #e2e8f0; 
                                                border-radius: 8px; 
                                                font-size: 14px; 
                                                background: white;
                                                transition: all 0.3s ease;
                                                font-weight: 500;
                                            " onfocus="this.style.borderColor='#dc2626'; this.style.boxShadow='0 0 0 3px rgba(220, 38, 38, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                                                <option value="">BranÅŸ seÃ§iniz</option>
                                                <option value="Futbol">Futbol</option>
                                                <option value="YÃ¼zme">YÃ¼zme</option>
                                                <option value="Tenis">Tenis</option>
                                                <option value="Basketbol">Basketbol</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.3px;">KullanÄ±cÄ± AdÄ±</label>
                                            <input type="text" id="userName" placeholder="GiriÅŸ iÃ§in kullanÄ±cÄ± adÄ±" style="
                                                width: 100%; 
                                                padding: 14px 16px; 
                                                border: 2px solid #e2e8f0; 
                                                border-radius: 8px; 
                                                font-size: 14px; 
                                                background: white;
                                                transition: all 0.3s ease;
                                                font-weight: 500;
                                            " onfocus="this.style.borderColor='#dc2626'; this.style.boxShadow='0 0 0 3px rgba(220, 38, 38, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                                        </div>
                                        <div>
                                            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.3px;">Åžifre</label>
                                            <input type="password" id="userPassword" placeholder="GÃ¼venli ÅŸifre girin" style="
                                                width: 100%; 
                                                padding: 14px 16px; 
                                                border: 2px solid #e2e8f0; 
                                                border-radius: 8px; 
                                                font-size: 14px; 
                                                background: white;
                                                transition: all 0.3s ease;
                                                font-weight: 500;
                                            " onfocus="this.style.borderColor='#dc2626'; this.style.boxShadow='0 0 0 3px rgba(220, 38, 38, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                                        </div>
                                        <div>
                                            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.3px;">Åžifre Tekrar</label>
                                            <input type="password" id="userPasswordConfirm" placeholder="Åžifreyi tekrar girin" style="
                                                width: 100%; 
                                                padding: 14px 16px; 
                                                border: 2px solid #e2e8f0; 
                                                border-radius: 8px; 
                                                font-size: 14px; 
                                                background: white;
                                                transition: all 0.3s ease;
                                                font-weight: 500;
                                            " onfocus="this.style.borderColor='#dc2626'; this.style.boxShadow='0 0 0 3px rgba(220, 38, 38, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                                        </div>
                                        <div>
                                            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.3px;">Yetki</label>
                                            <select id="userRole" style="
                                                width: 100%; 
                                                padding: 14px 16px; 
                                                border: 2px solid #e2e8f0; 
                                                border-radius: 8px; 
                                                font-size: 14px; 
                                                background: white;
                                                transition: all 0.3s ease;
                                                font-weight: 500;
                                            " onfocus="this.style.borderColor='#dc2626'; this.style.boxShadow='0 0 0 3px rgba(220, 38, 38, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                                                <option value="">Yetki seÃ§iniz</option>
                                                <option value="Admin">Admin</option>
                                                <option value="AntrenÃ¶r">AntrenÃ¶r</option>
                                                <option value="KullanÄ±cÄ±">KullanÄ±cÄ±</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.3px;">AntrenÃ¶rlÃ¼k Belgesi</label>
                                            <input type="file" id="userCertificate" accept=".pdf,.jpg,.jpeg,.png" style="
                                                width: 100%; 
                                                padding: 14px 16px; 
                                                border: 2px solid #e2e8f0; 
                                                border-radius: 8px; 
                                                font-size: 14px; 
                                                background: white;
                                                transition: all 0.3s ease;
                                                font-weight: 500;
                                            " onfocus="this.style.borderColor='#dc2626'; this.style.boxShadow='0 0 0 3px rgba(220, 38, 38, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                                        </div>
                                    </form>
                                    <div style="margin-top: 30px; display: flex; justify-content: flex-start;">
                                        <button onclick="saveUser()" style="
                                            background: linear-gradient(135deg, #dc2626, #b91c1c); 
                                            color: white; 
                                            border: none; 
                                            padding: 14px 28px; 
                                            border-radius: 8px; 
                                            font-weight: 600; 
                                            cursor: pointer; 
                                            font-size: 14px; 
                                            display: flex; 
                                            align-items: center; 
                                            gap: 8px;
                                            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
                                            transition: all 0.3s ease;
                                            text-transform: uppercase;
                                            letter-spacing: 0.5px;
                                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(220, 38, 38, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(220, 38, 38, 0.3)'">
                                            <i class="fas fa-save" style="font-size: 12px;"></i>
                                            Kaydet
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Mevcut KullanÄ±cÄ±lar Header -->
                            <div style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); border-radius: 12px 12px 0 0; padding: 16px 25px; margin-bottom: 0; box-shadow: 0 2px 10px rgba(99, 102, 241, 0.2);">
                                <div style="display: flex; align-items: center;">
                                    <div style="background: rgba(255, 255, 255, 0.2); padding: 6px; border-radius: 6px; margin-right: 10px;">
                                        <i class="fas fa-users" style="color: white; font-size: 14px;"></i>
                                    </div>
                                    <h4 style="margin: 0; color: white; font-size: 15px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Mevcut KullanÄ±cÄ±lar</h4>
                                </div>
                            </div>

                            <!-- Users List -->
                            <div id="usersList" style="background: white; border: 1px solid #e2e8f0; border-top: none; border-radius: 0 0 12px 12px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); overflow: hidden;">
                                <!-- Table Header -->
                                <div style="background: #f8fafc; padding: 16px 25px; border-bottom: 1px solid #e2e8f0; display: grid; grid-template-columns: 80px 2fr 1fr 1fr 1fr 1fr 120px; gap: 20px; align-items: center;">
                                    <div style="font-weight: 700; color: #374151; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">FotoÄŸraf</div>
                                    <div style="font-weight: 700; color: #374151; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">KullanÄ±cÄ± AdÄ±</div>
                                    <div style="font-weight: 700; color: #374151; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Rol</div>
                                    <div style="font-weight: 700; color: #374151; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Email</div>
                                    <div style="font-weight: 700; color: #374151; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Telefon</div>
                                    <div style="font-weight: 700; color: #374151; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Eklenme</div>
                                    <div style="font-weight: 700; color: #374151; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; text-align: center;">Ä°ÅŸlemler</div>
                                </div>

                                <!-- Dynamic content will be loaded here -->
                                <div id="usersTableBody">
                                    <div style="padding: 40px; text-align: center; color: #6b7280;">
                                        <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 10px;"></i>
                                        <p>KullanÄ±cÄ±lar yÃ¼kleniyor...</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- System Logs Tab -->
                        <div id="systemlogsTabContent" class="settings-tab-content" style="display: none; padding: 25px;">
                            <div style="margin-bottom: 25px;">
                                <h2 style="margin: 0; color: #1f2937; font-size: 16px; font-weight: 600;">Sistem LoglarÄ±</h2>
                                <p style="margin: 5px 0 0 0; color: #6b7280; font-size: 14px;">Sistem aktivitelerini gÃ¶rÃ¼ntÃ¼leyin ve yÃ¶netin</p>
                            </div>

                            <!-- Action Buttons -->
                            <div style="display: flex; gap: 15px; margin-bottom: 30px; justify-content: center;">
                                <button onclick="refreshLogs()" style="
                                    background: linear-gradient(135deg, #dc2626, #b91c1c); 
                                    color: white; 
                                    border: none; 
                                    padding: 12px 24px; 
                                    border-radius: 8px; 
                                    font-weight: 600; 
                                    cursor: pointer; 
                                    font-size: 14px; 
                                    display: flex; 
                                    align-items: center; 
                                    gap: 8px;
                                    box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
                                    transition: all 0.3s ease;
                                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(220, 38, 38, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(220, 38, 38, 0.3)'">
                                    <i class="fas fa-sync-alt" style="font-size: 12px;"></i>
                                    LoglarÄ± Yenile
                                </button>
                                <button onclick="clearAllLogs()" style="
                                    background: linear-gradient(135deg, #ef4444, #dc2626); 
                                    color: white; 
                                    border: none; 
                                    padding: 12px 24px; 
                                    border-radius: 8px; 
                                    font-weight: 600; 
                                    cursor: pointer; 
                                    font-size: 14px; 
                                    display: flex; 
                                    align-items: center; 
                                    gap: 8px;
                                    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
                                    transition: all 0.3s ease;
                                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(239, 68, 68, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(239, 68, 68, 0.3)'">
                                    <i class="fas fa-trash-alt" style="font-size: 12px;"></i>
                                    TÃ¼m LoglarÄ± Temizle
                                </button>
                            </div>

                            <!-- Stats Cards -->
                            <div style="display: flex; gap: 20px; margin-bottom: 30px;">
                                <div style="background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%); border: 1px solid #e2e8f0; border-radius: 12px; padding: 20px; flex: 1; text-align: center; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);">
                                    <div style="color: #6b7280; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;">Toplam Log:</div>
                                    <div id="totalLogsCount" style="color: #1f2937; font-size: 24px; font-weight: 700;">86</div>
                                </div>
                                <div style="background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%); border: 1px solid #e2e8f0; border-radius: 12px; padding: 20px; flex: 1; text-align: center; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);">
                                    <div style="color: #6b7280; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;">Son GÃ¼ncelleme:</div>
                                    <div id="lastUpdateTime" style="color: #1f2937; font-size: 16px; font-weight: 600;">14.09.2025 22:29:33</div>
                                </div>
                            </div>

                            <!-- Logs List -->
                            <div id="systemLogsList" style="background: white; border: 1px solid #e2e8f0; border-radius: 12px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); overflow: hidden;">
                                <!-- Dynamic content will be loaded here -->
                                <div id="logsTableBody" style="max-height: 400px; overflow-y: auto;">
                                    <div style="padding: 40px; text-align: center; color: #6b7280;">
                                        <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 10px;"></i>
                                        <p>Sistem loglarÄ± yÃ¼kleniyor...</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Data Management Tab -->
                        <div id="datamanagementTabContent" class="settings-tab-content" style="display: none; padding: 25px;">
                            <div style="margin-bottom: 25px;">
                                <h2 style="margin: 0; color: #1f2937; font-size: 16px; font-weight: 600;">
                                    <i class="fas fa-database" style="color: #dc2626; margin-right: 8px;"></i>
                                    Veri YÃ¶netimi
                                </h2>
                                <p style="margin: 5px 0 0 0; color: #6b7280; font-size: 14px;">Sistem verilerini yÃ¶netin ve gÃ¼venlik ayarlarÄ±nÄ± yapÄ±landÄ±rÄ±n</p>
                            </div>

                            <!-- Management Cards -->
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;">
                                <!-- Security Card -->
                                <div style="background: white; border: 1px solid #e2e8f0; border-radius: 12px; padding: 25px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); text-align: center;">
                                    <div style="background: linear-gradient(135deg, #dc2626, #b91c1c); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px auto;">
                                        <i class="fas fa-shield-alt" style="color: white; font-size: 20px;"></i>
                                    </div>
                                    <h3 style="margin: 0 0 8px 0; color: #dc2626; font-size: 16px; font-weight: 600;">
                                        <i class="fas fa-heart" style="color: #dc2626; font-size: 12px; margin-right: 5px;"></i>
                                        GÃ¼venlik
                                    </h3>
                                    <p style="margin: 0 0 20px 0; color: #6b7280; font-size: 13px; line-height: 1.4;">Admin KullanÄ±cÄ±sÄ±: <strong>admin</strong></p>
                                    <button onclick="openPasswordChangeModal()" style="
                                        background: #6b7280; 
                                        color: white; 
                                        border: none; 
                                        padding: 8px 16px; 
                                        border-radius: 6px; 
                                        font-size: 12px; 
                                        font-weight: 500; 
                                        cursor: pointer;
                                        display: flex;
                                        align-items: center;
                                        gap: 6px;
                                        margin: 0 auto;
                                        transition: all 0.2s ease;
                                    " onmouseover="this.style.background='#4b5563'" onmouseout="this.style.background='#6b7280'">
                                        <i class="fas fa-key" style="font-size: 10px;"></i>
                                        Åžifre DeÄŸiÅŸtir
                                    </button>
                                </div>

                                <!-- Backup Card -->
                                <div style="background: white; border: 1px solid #e2e8f0; border-radius: 12px; padding: 25px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); text-align: center;">
                                    <div style="background: linear-gradient(135deg, #dc2626, #b91c1c); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px auto;">
                                        <i class="fas fa-download" style="color: white; font-size: 20px;"></i>
                                    </div>
                                    <h3 style="margin: 0 0 8px 0; color: #dc2626; font-size: 16px; font-weight: 600;">
                                        <i class="fas fa-heart" style="color: #dc2626; font-size: 12px; margin-right: 5px;"></i>
                                        Yedekleme
                                    </h3>
                                    <p style="margin: 0 0 20px 0; color: #6b7280; font-size: 13px; line-height: 1.4;">TÃ¼m sistem verilerini gÃ¼venli bir ÅŸekilde yedekleyin</p>
                                    <button onclick="backupData(event)" style="
                                        background: #dc2626; 
                                        color: white; 
                                        border: none; 
                                        padding: 8px 16px; 
                                        border-radius: 6px; 
                                        font-size: 12px; 
                                        font-weight: 500; 
                                        cursor: pointer;
                                        display: flex;
                                        align-items: center;
                                        gap: 6px;
                                        margin: 0 auto;
                                        transition: all 0.2s ease;
                                    " onmouseover="this.style.background='#b91c1c'" onmouseout="this.style.background='#dc2626'">
                                        <i class="fas fa-download" style="font-size: 10px;"></i>
                                        Verileri Yedekle
                                    </button>
                                </div>

                                <!-- Restore Card -->
                                <div style="background: white; border: 1px solid #e2e8f0; border-radius: 12px; padding: 25px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); text-align: center;">
                                    <div style="background: linear-gradient(135deg, #dc2626, #b91c1c); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px auto;">
                                        <i class="fas fa-upload" style="color: white; font-size: 20px;"></i>
                                    </div>
                                    <h3 style="margin: 0 0 8px 0; color: #dc2626; font-size: 16px; font-weight: 600;">
                                        <i class="fas fa-heart" style="color: #dc2626; font-size: 12px; margin-right: 5px;"></i>
                                        Geri YÃ¼kleme
                                    </h3>
                                    <p style="margin: 0 0 20px 0; color: #6b7280; font-size: 13px; line-height: 1.4;">Ã–nceden yedeklenmiÅŸ verileri sisteme geri yÃ¼kleyin</p>
                                    <button onclick="restoreData()" style="
                                        background: #6b7280; 
                                        color: white; 
                                        border: none; 
                                        padding: 8px 16px; 
                                        border-radius: 6px; 
                                        font-size: 12px; 
                                        font-weight: 500; 
                                        cursor: pointer;
                                        display: flex;
                                        align-items: center;
                                        gap: 6px;
                                        margin: 0 auto;
                                        transition: all 0.2s ease;
                                    " onmouseover="this.style.background='#4b5563'" onmouseout="this.style.background='#6b7280'">
                                        <i class="fas fa-upload" style="font-size: 10px;"></i>
                                        Dosya SeÃ§ ve Geri YÃ¼kle
                                    </button>
                                </div>
                            </div>

                            <!-- Dangerous Operations -->
                            <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);">
                                <h3 style="margin: 0 0 15px 0; color: #dc2626; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-exclamation-triangle" style="color: #dc2626;"></i>
                                    Tehlikeli Ä°ÅŸlemler
                                </h3>
                                
                                <div style="background: #fef9c3; border: 1px solid #fde047; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                        <i class="fas fa-exclamation-triangle" style="color: #f59e0b; font-size: 16px;"></i>
                                        <span style="color: #92400e; font-size: 14px; font-weight: 500;">Bu iÅŸlem geri alÄ±namaz! TÃ¼m veriler kalÄ±cÄ± olarak silinecektir.</span>
                                    </div>
                                </div>

                                <button onclick="clearAllData()" style="
                                    background: #dc2626; 
                                    color: white; 
                                    border: none; 
                                    padding: 10px 20px; 
                                    border-radius: 6px; 
                                    font-size: 13px; 
                                    font-weight: 600; 
                                    cursor: pointer;
                                    display: flex;
                                    align-items: center;
                                    gap: 8px;
                                    transition: all 0.2s ease;
                                " onmouseover="this.style.background='#b91c1c'" onmouseout="this.style.background='#dc2626'">
                                    <i class="fas fa-trash-alt" style="font-size: 12px;"></i>
                                    TÃ¼m Verileri Sil
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <script>
                    let currentBranches = [];
                    let editingBranchId = null;

                    // Settings Tab Switching
                    document.addEventListener('DOMContentLoaded', function() {
                        // Initialize Supabase service first
                        if (typeof supabaseService !== 'undefined') {
                            supabaseService.initialize();
                            console.log('Supabase service initialized for settings page');
                        } else {
                            console.error('supabaseService not found');
                        }

                        const tabButtons = document.querySelectorAll('.settings-tab-btn');
                        const tabContents = document.querySelectorAll('.settings-tab-content');

                        tabButtons.forEach(btn => {
                            btn.addEventListener('click', () => {
                                const targetTab = btn.getAttribute('data-tab');
                                
                                // Update button styles
                                tabButtons.forEach(b => {
                                    b.style.background = '#f8f9fa';
                                    b.style.color = '#6b7280';
                                    b.style.border = '1px solid #d1d5db';
                                    b.style.borderBottom = '1px solid #d1d5db';
                                    b.classList.remove('active');
                                });
                                
                                btn.style.background = '#dc2626';
                                btn.style.color = 'white';
                                btn.style.border = '1px solid #dc2626';
                                btn.style.borderBottom = '1px solid #dc2626';
                                btn.classList.add('active');

                                // Update content visibility
                                tabContents.forEach(content => {
                                    content.style.display = 'none';
                                    content.classList.remove('active');
                                });
                                
                                // Show target content
                                const targetContent = document.getElementById(targetTab + 'TabContent');
                                if (targetContent) {
                                    targetContent.style.display = 'block';
                                    targetContent.classList.add('active');
                                }

                                // Load data when tabs are selected
                                if (targetTab === 'branches') {
                                    loadBranches();
                                } else if (targetTab === 'equipment') {
    console.log('=== EQUIPMENT TAB CLICKED ===');
    console.log('Loading equipment types...');
    
    loadEquipment();
    
    // Tab gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼nÃ¼ zorla
    setTimeout(() => {
        const equipmentTab = document.getElementById('equipmentTabContent');
        if (equipmentTab) {
            equipmentTab.style.display = 'block';
            console.log('Equipment tab visibility forced to block');
        }
    }, 100);
                                } else if (targetTab === 'users') {
                                    loadUsers();
                                } else if (targetTab === 'systemlogs') {
                                    loadSystemLogs();
                                }
                            });
                        });

                        // Load branches on page load
                        loadBranches();
                    });

                    async function loadBranches() {
                        try {
                            console.log('Loading sport branches from database...');
                            
                            // Ensure Supabase service is initialized
                            if (!supabaseService || !supabaseService.supabase) {
                                console.log('Initializing Supabase service...');
                                if (typeof supabaseService !== 'undefined') {
                                    supabaseService.initialize();
                                } else {
                                    throw new Error('supabaseService not available');
                                }
                            }
                            
                            const result = await supabaseService.getSportBranches();
                            
                            if (result.success && result.data) {
                                currentBranches = result.data;
                                renderBranches(currentBranches);
                            } else {
                                console.error('Error loading branches:', result.error);
                                showBranchesError('Spor branÅŸlarÄ± yÃ¼klenirken hata oluÅŸtu.');
                            }
                        } catch (error) {
                            console.error('Error loading branches:', error);
                            showBranchesError('Spor branÅŸlarÄ± yÃ¼klenirken hata oluÅŸtu.');
                        }
                    }

                    function renderBranches(branches) {
                        const tableBody = document.getElementById('branchesTableBody');
                        
                        if (!branches || branches.length === 0) {
                            tableBody.innerHTML = `
                                <div style="padding: 40px; text-align: center; color: #6b7280;">
                                    <i class="fas fa-running" style="font-size: 32px; margin-bottom: 12px; opacity: 0.5;"></i>
                                    <p style="margin: 0; font-size: 14px;">HenÃ¼z spor branÅŸÄ± eklenmemiÅŸ.</p>
                                </div>
                            `;
                            return;
                        }

                        const branchesHtml = branches.map((branch, index) => {
                            const isLast = index === branches.length - 1;
                            const startDate = branch.start_date ? new Date(branch.start_date).toLocaleDateString('tr-TR') : '-';
                            const endDate = branch.end_date ? new Date(branch.end_date).toLocaleDateString('tr-TR') : '-';
                            
                            return `
                                <div style="padding: 20px 25px; ${!isLast ? 'border-bottom: 1px solid #f1f5f9;' : ''} display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr 120px; gap: 20px; align-items: center; transition: all 0.2s ease;" onmouseover="this.style.backgroundColor='#f8fafc'" onmouseout="this.style.backgroundColor='white'">
                                    <div>
                                        <h3 style="margin: 0; color: #1f2937; font-size: 16px; font-weight: 600;">${branch.name || 'Bilinmeyen BranÅŸ'}</h3>
                                    </div>
                                    <div style="color: #374151; font-size: 14px; font-weight: 500;">${branch.capacity || 0} kiÅŸi</div>
                                    <div style="color: #374151; font-size: 14px; font-weight: 500;">${branch.age_group || '-'}</div>
                                    <div style="color: #374151; font-size: 14px; font-weight: 500;">${branch.fee || 0} â‚º</div>
                                    <div style="color: #374151; font-size: 14px; font-weight: 500;">${startDate}</div>
                                    <div style="color: #374151; font-size: 14px; font-weight: 500;">${endDate}</div>
                                    <div style="display: flex; gap: 8px; justify-content: center;">
                                        <button onclick="editBranch('${branch.id}')" style="
                                            background: linear-gradient(135deg, #3b82f6, #2563eb); 
                                            color: white; 
                                            border: none; 
                                            padding: 8px 12px; 
                                            border-radius: 6px; 
                                            cursor: pointer; 
                                            font-size: 11px; 
                                            display: flex; 
                                            align-items: center; 
                                            gap: 4px;
                                            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
                                            transition: all 0.2s ease;
                                            font-weight: 500;
                                        " onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(59, 130, 246, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(59, 130, 246, 0.3)'">
                                            <i class="fas fa-edit" style="font-size: 10px;"></i>
                                            DÃ¼zenle
                                        </button>
                                        <button onclick="deleteBranch('${branch.id}')" style="
                                            background: linear-gradient(135deg, #ef4444, #dc2626); 
                                            color: white; 
                                            border: none; 
                                            padding: 8px 12px; 
                                            border-radius: 6px; 
                                            cursor: pointer; 
                                            font-size: 11px; 
                                            display: flex; 
                                            align-items: center; 
                                            gap: 4px;
                                            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
                                            transition: all 0.2s ease;
                                            font-weight: 500;
                                        " onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(239, 68, 68, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(239, 68, 68, 0.3)'">
                                            <i class="fas fa-trash" style="font-size: 10px;"></i>
                                            Sil
                                        </button>
                                    </div>
                                </div>
                            `;
                        }).join('');

                        tableBody.innerHTML = branchesHtml;
                    }

                    function showBranchesError(message) {
                        const tableBody = document.getElementById('branchesTableBody');
                        tableBody.innerHTML = `
                            <div style="padding: 40px; text-align: center; color: #ef4444;">
                                <i class="fas fa-exclamation-triangle" style="font-size: 32px; margin-bottom: 12px;"></i>
                                <p style="margin: 0; font-size: 14px;">${message}</p>
                            </div>
                        `;
                    }

                    function editBranch(branchId) {
                        const branch = currentBranches.find(b => b.id === branchId);
                        if (!branch) {
                            alert('BranÅŸ bulunamadÄ±!');
                            return;
                        }

                        // Fill form with branch data
                        document.getElementById('editingBranchId').value = branchId;
                        document.getElementById('branchName').value = branch.name || '';
                        document.getElementById('branchCapacity').value = branch.capacity || '';
                        document.getElementById('branchAgeGroup').value = branch.age_group || '';
                        document.getElementById('branchFee').value = branch.fee || '';
                        
                        // Format dates for input fields
                        if (branch.start_date) {
                            const startDate = new Date(branch.start_date);
                            document.getElementById('branchStartDate').value = startDate.toISOString().split('T')[0];
                        }
                        if (branch.end_date) {
                            const endDate = new Date(branch.end_date);
                            document.getElementById('branchEndDate').value = endDate.toISOString().split('T')[0];
                        }

                        // Scroll to form
                        document.getElementById('branchForm').scrollIntoView({ behavior: 'smooth' });
                        
                        // Focus on first input
                        document.getElementById('branchName').focus();
                    }

                    async function deleteBranch(branchId) {
                        const branch = currentBranches.find(b => b.id === branchId);
                        if (!branch) {
                            alert('BranÅŸ bulunamadÄ±!');
                            return;
                        }

                        if (!confirm(`"${branch.name}" branÅŸÄ±nÄ± silmek istediÄŸinizden emin misiniz?`)) {
                            return;
                        }

                        try {
                            // Ensure Supabase service is initialized
                            if (!supabaseService || !supabaseService.supabase) {
                                if (typeof supabaseService !== 'undefined') {
                                    supabaseService.initialize();
                                } else {
                                    alert('Supabase servisi mevcut deÄŸil!');
                                    return;
                                }
                            }

                            const result = await supabaseService.deleteSportBranch(branchId);
                            if (result.success) {
                                alert('BranÅŸ baÅŸarÄ±yla silindi.');
                                // Listeyi yenile
                                loadBranches();
                            } else {
                                alert('BranÅŸ silinirken hata oluÅŸtu: ' + (result.error || 'Bilinmeyen hata'));
                            }
                        } catch (error) {
                            console.error('Error deleting branch:', error);
                            alert('BranÅŸ silinemedi. LÃ¼tfen daha sonra tekrar deneyin.');
                        }
                    }

                    async function saveBranch() {
                        // Ensure Supabase service is initialized
                        if (!supabaseService || !supabaseService.supabase) {
                            console.log('Initializing Supabase service...');
                            if (typeof supabaseService !== 'undefined') {
                                supabaseService.initialize();
                            } else {
                                alert('Supabase servisi mevcut deÄŸil!');
                                return;
                            }
                        }

                        const editingId = document.getElementById('editingBranchId').value;
                        const branchData = {
                            name: document.getElementById('branchName').value.trim(),
                            capacity: parseInt(document.getElementById('branchCapacity').value) || 0,
                            age_group: document.getElementById('branchAgeGroup').value.trim(),
                            fee: parseFloat(document.getElementById('branchFee').value) || 0,
                            start_date: document.getElementById('branchStartDate').value || null,
                            end_date: document.getElementById('branchEndDate').value || null
                        };

                        // Validation
                        if (!branchData.name) {
                            alert('BranÅŸ adÄ± gereklidir!');
                            document.getElementById('branchName').focus();
                            return;
                        }

                        try {
                            let result;
                            if (editingId) {
                                // Update existing branch
                                result = await supabaseService.updateSportBranch(editingId, branchData);
                                if (result.success) {
                                    alert('BranÅŸ baÅŸarÄ±yla gÃ¼ncellendi!');
                                    clearForm();
                                    loadBranches();
                                } else {
                                    alert('BranÅŸ gÃ¼ncellenirken hata oluÅŸtu: ' + (result.error || 'Bilinmeyen hata'));
                                }
                            } else {
                                // Create new branch
                                result = await supabaseService.createSportBranch(branchData);
                                if (result.success) {
                                    alert('BranÅŸ baÅŸarÄ±yla eklendi!');
                                    clearForm();
                                    loadBranches();
                                } else {
                                    alert('BranÅŸ eklenirken hata oluÅŸtu: ' + (result.error || 'Bilinmeyen hata'));
                                }
                            }
                        } catch (error) {
                            console.error('Error saving branch:', error);
                            alert('BranÅŸ kaydedilirken hata oluÅŸtu!');
                        }
                    }

                    function clearForm() {
                        document.getElementById('editingBranchId').value = '';
                        document.getElementById('branchName').value = '';
                        document.getElementById('branchCapacity').value = '';
                        document.getElementById('branchAgeGroup').value = '';
                        document.getElementById('branchFee').value = '';
                        document.getElementById('branchStartDate').value = '';
                        document.getElementById('branchEndDate').value = '';
                    }

                    // Equipment Management Functions
                    let currentEquipment = [];

                    async function loadEquipment() {
                        try {
                            console.log('Loading equipment from database...');
                            
                            // Ensure Supabase service is initialized
                            if (!supabaseService || !supabaseService.supabase) {
                                console.log('Initializing Supabase service...');
                                if (typeof supabaseService !== 'undefined') {
                                    supabaseService.initialize();
                                } else {
                                    throw new Error('supabaseService not available');
                                }
                            }
                            
                            const result = await supabaseService.getEquipmentTypes();
                            
                            if (result.success && result.data) {
                              currentEquipment = result.data;
                              renderEquipment(currentEquipment);
                          } else {
                              console.error('Error loading equipment:', result.error);
                              showEquipmentError('Ekipman tÃ¼rleri yÃ¼klenirken hata oluÅŸtu.');
                          }
                        } catch (error) {
                            console.error('Error loading equipment:', error);
                            showEquipmentError('Ekipman tÃ¼rleri yÃ¼klenemedi.');
                        }
                    }

                    function renderEquipment(equipment) {
                        const tableBody = document.getElementById('equipmentTableBody');
                        
                        if (!equipment || equipment.length === 0) {
                            tableBody.innerHTML = `
                                <div style="padding: 40px; text-align: center; color: #6b7280;">
                                    <i class="fas fa-warehouse" style="font-size: 32px; margin-bottom: 12px; opacity: 0.5;"></i>
                                    <p style="margin: 0; font-size: 14px;">HenÃ¼z ekipman tÃ¼rÃ¼ eklenmemiÅŸ.</p>
                                </div>
                            `;
                            return;
                        }

                        // Group rows by parent group id (size_id || id)
                        const groups = equipment.reduce((acc, et) => {
                            const parentId = et.size_id || et.id;
                            if (!acc[parentId]) acc[parentId] = [];
                            acc[parentId].push(et);
                            return acc;
                        }, {});

                        const html = Object.keys(groups).map(groupId => {
                            const rows = groups[groupId];
                            const parentId = groupId;
                            const parentRow = rows.find(r => r.id === parentId) || rows[0];
                            const name = (parentRow && parentRow.name) ? parentRow.name : (rows[0].name || 'DiÄŸer');
                            const totalQty = rows.reduce((s, r) => s + (parseInt(r.quantity, 10) || 0), 0);
                            const totalAvail = rows.reduce((s, r) => {
                                if (typeof r.available_quantity === 'number') return s + r.available_quantity;
                                const q = parseInt(r.quantity, 10) || 0;
                                return s + Math.max(0, q);
                            }, 0);
                            const photo = (parentRow && parentRow.photo_url) ? parentRow.photo_url : ((rows.find(r => !!r.photo_url) || {}).photo_url || '');
                            const created = parentRow && parentRow.created_at ? new Date(parentRow.created_at).toLocaleDateString('tr-TR') : (rows[0] && rows[0].created_at ? new Date(rows[0].created_at).toLocaleDateString('tr-TR') : '-');
                            const sizeRows = rows.map(r => {
                                const q = parseInt(r.quantity, 10) || 0;
                                const avail = (typeof r.available_quantity === 'number') ? r.available_quantity : q;
                                const assigned = Math.max(0, q - avail);
                                return { id: r.id, size: (r.size || '-'), quantity: q, assigned, available: avail };
                            }).sort((a, b) => (a.size + '').localeCompare(b.size + '', 'tr'));
                            const firstId = parentRow && parentRow.id ? parentRow.id : rows[0].id;

                            return `
                                <div style="background: white; border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                    <div style="display: flex; align-items: center; gap: 16px;">
                                        <div style="width: 60px; height: 60px; border-radius: 8px; background: #f3f4f6; display: flex; align-items: center; justify-content: center; flex-shrink: 0; overflow: hidden;">
                                            ${photo 
                                                ? `<img src="${photo}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">`
                                                : `<i class=\"fas fa-tshirt\" style=\"color: #9CA3AF; font-size: 24px;\"></i>`}
                                        </div>
                                        <div style="flex: 1;">
                                            <h4 style="margin: 0 0 8px 0; font-size: 16px; font-weight: 600; color: #1F2937;">${name}</h4>
                                            <div style="font-size: 12px; color: #6B7280;">Toplam Stok: ${totalQty} â€¢ MÃ¼sait: ${totalAvail}</div>
                                            <div style="font-size: 11px; color: #9CA3AF; margin-top: 6px;"><i class="fas fa-calendar"></i> Ä°lk KayÄ±t: ${created}</div>

                                            <div style="margin-top: 10px; background: #f8fafc; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden;">
                                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; padding: 8px 12px; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb; background: #f1f5f9;">
                                                    <div>Beden</div>
                                                    <div>Stok</div>
                                                    <div>MÃ¼sait</div>
                                                </div>
                                                ${sizeRows.map(sr => `
                                                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; padding: 8px 12px; border-bottom: 1px dashed #e5e7eb; color: #374151;">
                                                        <div>${sr.size}</div>
                                                        <div>${sr.quantity}</div>
                                                        <div>${sr.available}</div>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <button onclick="app.showAddStockModal('${firstId}', '${name.replace(/'/g, "\\'")}')" style="background: #10B981; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: 600;">
                                                <i class="fas fa-plus-circle"></i> Stok Ekle
                                            </button>
                                            <button onclick="editEquipment('${firstId}')" style="background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 11px; display: flex; align-items: center; gap: 4px; box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3); transition: all 0.2s ease; font-weight: 500;">
                                                <i class="fas fa-edit" style="font-size: 10px;"></i> DÃ¼zenle
                                            </button>
                                            <button onclick="deleteEquipment('${firstId}')" style="background: linear-gradient(135deg, #ef4444, #dc2626); color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 11px; display: flex; align-items: center; gap: 4px; box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3); transition: all 0.2s ease; font-weight: 500;">
                                                <i class="fas fa-trash" style="font-size: 10px;"></i> Sil
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('');

                        tableBody.innerHTML = html;
                    }

                    function showEquipmentError(message) {
                        const tableBody = document.getElementById('equipmentTableBody');
                        tableBody.innerHTML = `
                            <div style="padding: 40px; text-align: center; color: #ef4444;">
                                <i class="fas fa-exclamation-triangle" style="font-size: 32px; margin-bottom: 12px;"></i>
                                <p style="margin: 0; font-size: 14px;">${message}</p>
                            </div>
                        `;
                    }

                    function editEquipment(equipmentId) {
                        const equipment = currentEquipment.find(e => e.id === equipmentId);
                        if (!equipment) {
                            alert('Ekipman bulunamadÄ±!');
                            return;
                        }

                        // Fill form with equipment data
                        document.getElementById('editingEquipmentId').value = equipmentId;
                        document.getElementById('equipmentName').value = equipment.name || '';
                        document.getElementById('equipmentFee').value = (equipment.fee != null && equipment.fee !== '') ? equipment.fee : '';

                        // Scroll to form
                        document.getElementById('equipmentForm').scrollIntoView({ behavior: 'smooth' });
                        
                        // Focus on first input
                        document.getElementById('equipmentName').focus();
                    }

                    async function deleteEquipment(equipmentId) {
                        const equipment = currentEquipment.find(e => e.id === equipmentId);
                        if (!equipment) {
                            alert('Ekipman bulunamadÄ±!');
                            return;
                        }

                        if (confirm(`"${equipment.name}" ekipmanÄ±nÄ± silmek istediÄŸinizden emin misiniz?`)) {
                            try {
                                const result = await supabaseService.deleteEquipmentType(equipmentId);
                                if (result.success) {
                                    alert('Ekipman baÅŸarÄ±yla silindi!');
                                    loadEquipment(); // Listeyi yenile
                                } else {
                                    alert('Ekipman silinirken hata oluÅŸtu: ' + result.error);
                                }
                            } catch (error) {
                                console.error('Delete equipment error:', error);
                                alert('Ekipman silinirken hata oluÅŸtu.');
                            }
                        }
                    }

                    async function saveEquipment() {
                        // Ensure Supabase service is initialized
                        if (!supabaseService || !supabaseService.supabase) {
                            console.log('Initializing Supabase service...');
                            if (typeof supabaseService !== 'undefined') {
                                supabaseService.initialize();
                            } else {
                                alert('Supabase servisi mevcut deÄŸil!');
                                return;
                            }
                        }

                        const editingId = document.getElementById('editingEquipmentId').value;
                        const photoFile = document.getElementById('equipmentPhoto').files[0];

                        const equipmentData = {
                            name: document.getElementById('equipmentName').value.trim(),
                            // Beden ve miktar bu ekranda yÃ¶netilmiyor; varsayÄ±lan boÅŸ bedene 0 stok olarak kaydediyoruz
                            size: '-',
                            quantity: 0,
                            fee: document.getElementById('equipmentFee').value ? parseFloat(document.getElementById('equipmentFee').value) : null,
                            photo_url: null
                        };

                        // Handle photo upload if file is selected
                        if (photoFile) {
                            try {
                                // Convert file to base64 for simple storage
                                const reader = new FileReader();
                                const photoDataUrl = await new Promise((resolve) => {
                                    reader.onload = (e) => resolve(e.target.result);
                                    reader.readAsDataURL(photoFile);
                                });
                                equipmentData.photo_url = photoDataUrl;
                                console.log('Photo added to equipment data');
                            } catch (error) {
                                console.error('Error processing photo:', error);
                                alert('FotoÄŸraf yÃ¼klenirken hata oluÅŸtu, fotoÄŸraf olmadan devam ediliyor.');
                            }
                        }

                        // Validation
                        if (!equipmentData.name) {
                            alert('Ekipman adÄ± gereklidir!');
                            document.getElementById('equipmentName').focus();
                            return;
                        }

                        try {
                            let result;
                            if (editingId) {
                                // Update existing equipment
                                result = await supabaseService.updateEquipmentType(editingId, equipmentData);
                                if (result.success) {
                                    const propagated = result.data && result.data.propagated;
                                    const msg = propagated
                                        ? 'Ekipman gÃ¼ncellendi. AynÄ± gruptaki (size_id) tÃ¼m beden/variant alanlarÄ± senkronize edildi.'
                                        : 'Ekipman baÅŸarÄ±yla gÃ¼ncellendi!';
                                    alert(msg);
                                    clearEquipmentForm();
                                    loadEquipment();
                                } else {
                                    alert('Ekipman gÃ¼ncellenirken hata oluÅŸtu: ' + (result.error || 'Bilinmeyen hata'));
                                }
                            } else {
                                // Create new equipment
                                result = await supabaseService.createEquipmentType(equipmentData);
                                if (result.success) {
                                    alert('Ekipman baÅŸarÄ±yla eklendi!');
                                    clearEquipmentForm();
                                    loadEquipment();
                                } else {
                                    alert('Ekipman eklenirken hata oluÅŸtu: ' + (result.error || 'Bilinmeyen hata'));
                                }
                            }
                        } catch (error) {
                            console.error('Error saving equipment:', error);
                            alert('Ekipman kaydedilirken hata oluÅŸtu!');
                        }
                    }

                    function clearEquipmentForm() {
                        document.getElementById('editingEquipmentId').value = '';
                        document.getElementById('equipmentName').value = '';
                        document.getElementById('equipmentPhoto').value = '';
                        document.getElementById('equipmentFee').value = '';
                    }

                    // User Management Functions
                    let currentUsers = [];

                    // Helper function to display role names in Turkish
                    function getRoleDisplayName(role) {
                        const roleMap = {
                            'admin': 'Admin',
                            'coach': 'AntrenÃ¶r',
                            'user': 'KullanÄ±cÄ±'
                        };
                        return roleMap[role] || 'KullanÄ±cÄ±';
                    }

                    // TC Kimlik No validation function
                    function validateTCKimlikNo(tcNo) {
                        // Remove spaces and convert to string
                        tcNo = tcNo.toString().replace(/\s/g, '');
                        
                        // Check if it's 11 digits
                        if (!/^\d{11}$/.test(tcNo)) {
                            return false;
                        }
                        
                        // Convert to array of numbers
                        const digits = tcNo.split('').map(Number);
                        
                        // First digit cannot be 0
                        if (digits[0] === 0) {
                            return false;
                        }
                        
                        // Calculate checksum
                        let sum1 = 0, sum2 = 0;
                        
                        // Sum of odd positioned digits (1st, 3rd, 5th, 7th, 9th)
                        for (let i = 0; i < 9; i += 2) {
                            sum1 += digits[i];
                        }
                        
                        // Sum of even positioned digits (2nd, 4th, 6th, 8th)
                        for (let i = 1; i < 8; i += 2) {
                            sum2 += digits[i];
                        }
                        
                        // 10th digit check
                        const check1 = (sum1 * 7 - sum2) % 10;
                        if (check1 !== digits[9]) {
                            return false;
                        }
                        
                        // 11th digit check
                        const totalSum = sum1 + sum2 + digits[9];
                        const check2 = totalSum % 10;
                        if (check2 !== digits[10]) {
                            return false;
                        }
                        
                        return true;
                    }

                    // Password hashing function using Web Crypto API
                    async function hashPassword(password) {
                        try {
                            // Convert password to ArrayBuffer
                            const encoder = new TextEncoder();
                            const data = encoder.encode(password);
                            
                            // Hash the password using SHA-256
                            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                            
                            // Convert ArrayBuffer to hex string
                            const hashArray = Array.from(new Uint8Array(hashBuffer));
                            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                            
                            return hashHex;
                        } catch (error) {
                            console.error('Password hashing error:', error);
                            // Fallback to simple encoding (not recommended for production)
                            return btoa(password);
                        }
                    }

                    async function loadUsers() {
                        try {
                            console.log('Loading users from database...');
                            
                            // Ensure Supabase service is initialized
                            if (!supabaseService || !supabaseService.supabase) {
                                console.log('Initializing Supabase service...');
                                if (typeof supabaseService !== 'undefined') {
                                    supabaseService.initialize();
                                } else {
                                    throw new Error('supabaseService not available');
                                }
                            }
                            
                            // First get the schema to understand available fields
                            const schemaResult = await supabaseService.getUserProfilesSchema();
                            if (schemaResult.success) {
                                console.log('user_profiles table fields:', schemaResult.fields);
                            }
                            
                            const result = await supabaseService.getUsers();
                            
                            if (result.success && result.data) {
                                currentUsers = result.data;
                                console.log('User profiles data:', result.data);
                                if (result.data.length > 0) {
                                    console.log('First user fields:', Object.keys(result.data[0]));
                                }
                                renderUsers(currentUsers);
                            } else {
                                console.error('Error loading users:', result.error);
                                showUsersError('KullanÄ±cÄ±lar yÃ¼klenirken hata oluÅŸtu.');
                            }
                        } catch (error) {
                            console.error('Error loading users:', error);
                            showUsersError('KullanÄ±cÄ±lar yÃ¼klenirken hata oluÅŸtu.');
                        }
                    }

                    function renderUsers(users) {
                        const tableBody = document.getElementById('usersTableBody');
                        
                        if (!users || users.length === 0) {
                            tableBody.innerHTML = `
                                <div style="padding: 40px; text-align: center; color: #6b7280;">
                                    <i class="fas fa-users" style="font-size: 32px; margin-bottom: 12px; opacity: 0.5;"></i>
                                    <p style="margin: 0; font-size: 14px;">HenÃ¼z kullanÄ±cÄ± eklenmemiÅŸ.</p>
                                </div>
                            `;
                            return;
                        }

                        const usersHtml = users.map((user, index) => {
                            const isLast = index === users.length - 1;
                            const createdDate = user.created_at ? new Date(user.created_at).toLocaleDateString('tr-TR') : '-';
                            
                            // Handle different image sources for user_profiles table
                            let hasImage = false;
                            let photoUrl = '';
                            
                            if (user.avatar_url && user.avatar_url.trim() !== '') {
                                photoUrl = user.avatar_url;
                                hasImage = true;
                            } else if (user.photo_url && user.photo_url.trim() !== '') {
                                photoUrl = user.photo_url;
                                hasImage = true;
                            } else if (user.photo && user.photo.trim() !== '') {
                                photoUrl = user.photo;
                                hasImage = true;
                            }
                            
                            // Get first letter from available name fields
                            const displayName = user.full_name || user.name || user.display_name || user.username || 'KullanÄ±cÄ±';
                            const firstLetter = displayName.charAt(0).toUpperCase();
                            
                            return `
                                <div style="padding: 20px 25px; ${!isLast ? 'border-bottom: 1px solid #f1f5f9;' : ''} display: grid; grid-template-columns: 80px 2fr 1fr 1fr 1fr 1fr 120px; gap: 20px; align-items: center; transition: all 0.2s ease;" onmouseover="this.style.backgroundColor='#f8fafc'" onmouseout="this.style.backgroundColor='white'">
                                    <div>
                                        ${hasImage ? 
                                            `<img src="${photoUrl}" alt="${user.full_name || user.username || 'KullanÄ±cÄ±'}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px; border: 2px solid #e2e8f0; background: #f8fafc;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                             <div style="display: none; width: 60px; height: 60px; background: linear-gradient(135deg, #6366f1, #8b5cf6); border-radius: 8px; border: 2px solid #e2e8f0; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 20px;">${firstLetter}</div>` :
                                            `<div style="width: 60px; height: 60px; background: linear-gradient(135deg, #6366f1, #8b5cf6); border-radius: 8px; border: 2px solid #e2e8f0; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 20px;">${firstLetter}</div>`
                                        }
                                    </div>
                                    <div>
                                        <h3 style="margin: 0; color: #1f2937; font-size: 16px; font-weight: 600;">${displayName}</h3>
                                        <p style="margin: 2px 0 0 0; color: #6b7280; font-size: 12px;">${user.username || user.email || '-'}</p>
                                    </div>
                                    <div style="color: #374151; font-size: 14px; font-weight: 500;">
                                        <span style="background: ${user.role === 'admin' ? '#dc2626' : user.role === 'coach' ? '#059669' : '#6366f1'}; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">${getRoleDisplayName(user.role)}</span>
                                    </div>
                                    <div style="color: #374151; font-size: 14px; font-weight: 500;">${user.email || '-'}</div>
                                    <div style="color: #374151; font-size: 14px; font-weight: 500;">${user.phone || '-'}</div>
                                    <div style="color: #374151; font-size: 14px; font-weight: 500;">${createdDate}</div>
                                    <div style="display: flex; flex-direction: column; gap: 6px; align-items: center;">
                                        <div style="display: flex; gap: 8px;">
                                            <button onclick="editUser('${user.id}')" style="
                                                background: linear-gradient(135deg, #3b82f6, #2563eb); 
                                                color: white; 
                                                border: none; 
                                                padding: 8px 12px; 
                                                border-radius: 6px; 
                                                cursor: pointer; 
                                                font-size: 11px; 
                                                display: flex; 
                                                align-items: center; 
                                                gap: 4px;
                                                box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
                                                transition: all 0.2s ease;
                                                font-weight: 500;
                                            " onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(59, 130, 246, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(59, 130, 246, 0.3)'">
                                                <i class="fas fa-edit" style="font-size: 10px;"></i>
                                                DÃ¼zenle
                                            </button>
                                            <button onclick="deleteUser('${user.id}')" style="
                                                background: linear-gradient(135deg, #ef4444, #dc2626); 
                                                color: white; 
                                                border: none; 
                                                padding: 8px 12px; 
                                                border-radius: 6px; 
                                                cursor: pointer; 
                                                font-size: 11px; 
                                                display: flex; 
                                                align-items: center; 
                                                gap: 4px;
                                                box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
                                                transition: all 0.2s ease;
                                                font-weight: 500;
                                            " onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(239, 68, 68, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(239, 68, 68, 0.3)'">
                                                <i class="fas fa-trash" style="font-size: 10px;"></i>
                                                Sil
                                            </button>
                                        </div>
                                        ${user.certificate_url ? `
                                        <button onclick="viewCertificate('${user.certificate_url}')" style="
                                            background: linear-gradient(135deg, #059669, #047857); 
                                            color: white; 
                                            border: none; 
                                            padding: 6px 10px; 
                                            border-radius: 6px; 
                                            cursor: pointer; 
                                            font-size: 10px; 
                                            display: flex; 
                                            align-items: center; 
                                            gap: 4px;
                                            box-shadow: 0 2px 8px rgba(5, 150, 105, 0.3);
                                            transition: all 0.2s ease;
                                            font-weight: 500;
                                        " onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(5, 150, 105, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(5, 150, 105, 0.3)'">
                                            <i class="fas fa-certificate" style="font-size: 9px;"></i>
                                            Belge GÃ¶rÃ¼ntÃ¼le
                                        </button>
                                        ` : ''}
                                    </div>
                                </div>
                            `;
                        }).join('');

                        tableBody.innerHTML = usersHtml;
                    }

                    function showUsersError(message) {
                        const tableBody = document.getElementById('usersTableBody');
                        tableBody.innerHTML = `
                            <div style="padding: 40px; text-align: center; color: #ef4444;">
                                <i class="fas fa-exclamation-triangle" style="font-size: 32px; margin-bottom: 12px;"></i>
                                <p style="margin: 0; font-size: 14px;">${message}</p>
                            </div>
                        `;
                    }

                    function editUser(userId) {
                        const user = currentUsers.find(u => u.id === userId);
                        if (!user) {
                            alert('KullanÄ±cÄ± bulunamadÄ±!');
                            return;
                        }

                        // Fill form with user data from user_profiles table schema
                        document.getElementById('editingUserId').value = userId;
                        document.getElementById('userTcNo').value = user.tc_no || '';
                        document.getElementById('userFullName').value = user.full_name || '';
                        document.getElementById('userBirthDate').value = user.birth_date || '';
                        document.getElementById('userPhone').value = user.phone || '';
                        document.getElementById('userEmail').value = user.email || '';
                        document.getElementById('userBranch').value = user.branch || user.sport || '';
                        document.getElementById('userName').value = user.username || '';
                        document.getElementById('userRole').value = mapSchemaRoleToForm(user.role) || '';

                        // Helper function to map schema role to form values
                        function mapSchemaRoleToForm(role) {
                            const roleMap = {
                                'admin': 'Admin',
                                'coach': 'AntrenÃ¶r',
                                'user': 'KullanÄ±cÄ±'
                            };
                            return roleMap[role] || 'KullanÄ±cÄ±';
                        }
                        
                        // Clear password fields for security
                        document.getElementById('userPassword').value = '';
                        document.getElementById('userPasswordConfirm').value = '';

                        // Scroll to form
                        document.getElementById('userForm').scrollIntoView({ behavior: 'smooth' });
                        
                        // Focus on first input
                        document.getElementById('userTcNo').focus();
                    }

                    async function deleteUser(userId) {
    const user = currentUsers.find(u => u.id === userId);
    if (!user) {
        alert('KullanÄ±cÄ± bulunamadÄ±!');
        return;
    }

    // Admin kullanÄ±cÄ±sÄ±nÄ± silmeyi engelle
    if (user.email === 'admin@atkoy.com' || user.username === 'admin') {
        alert('Admin kullanÄ±cÄ±sÄ± silinemez!');
        return;
    }

    if (confirm(`"${user.full_name || user.username}" kullanÄ±cÄ±sÄ±nÄ± silmek istediÄŸinizden emin misiniz?`)) {
        try {
            const result = await supabaseService.deleteUser(userId);
            if (result.success) {
                alert('KullanÄ±cÄ± baÅŸarÄ±yla silindi!');
                loadUsers(); // Listeyi yenile
            } else {
                alert('KullanÄ±cÄ± silinirken hata oluÅŸtu: ' + result.error);
            }
        } catch (error) {
            console.error('Delete user error:', error);
            alert('KullanÄ±cÄ± silinirken hata oluÅŸtu.');
        }
    }
}

function viewCertificate(certificateUrl) {
    if (!certificateUrl) {
        alert('Belge bulunamadÄ±!');
        return;
    }

    // Basit iÃ§erik tÃ¼rÃ¼ tespiti
    const urlLower = certificateUrl.toLowerCase();
    const isDataUrl = urlLower.startsWith('data:');
    let mime = null;

    if (isDataUrl) {
        // data:<mime>;base64,...
        const semi = certificateUrl.indexOf(';');
        if (semi > 5) {
            mime = certificateUrl.substring(5, semi); // "application/pdf" veya "image/png" gibi
        }
    } else {
        // UzantÄ±ya gÃ¶re tahmin
        if (urlLower.endsWith('.pdf')) mime = 'application/pdf';
        else if (urlLower.match(/\.(png|jpg|jpeg|gif|webp|bmp|svg)$/)) mime = 'image/*';
    }

    // Modal
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed; inset: 0; background: rgba(0,0,0,.8);
        display: flex; justify-content: center; align-items: center; z-index: 10000;
    `;

    const content = document.createElement('div');
    content.style.cssText = `
        background: white; border-radius: 12px; padding: 20px;
        max-width: 90%; max-height: 90%; overflow: auto; position: relative;
    `;

    // BaÅŸlÄ±k
    const titleBar = document.createElement('div');
    titleBar.style.cssText = 'display:flex; align-items:center; justify-content:space-between; margin-bottom:12px;';

    const title = document.createElement('h3');
    title.textContent = 'AntrenÃ¶rlÃ¼k Belgesi';
    title.style.cssText = 'margin: 0; color: #333;';

    // Ä°ndir butonu
    const actions = document.createElement('div');
    const downloadBtn = document.createElement('a');
    downloadBtn.href = certificateUrl;
    downloadBtn.download = 'belge';
    downloadBtn.textContent = 'Ä°ndir';
    downloadBtn.style.cssText = `
        background:#059669; color:white; padding:8px 12px; border-radius:8px; 
        text-decoration:none; font-weight:500; margin-right:8px;
    `;

    // Kapat butonu
    const closeBtn = document.createElement('button');
    closeBtn.innerHTML = 'Ã—';
    closeBtn.style.cssText = `
        background: none; border: none; font-size: 24px; cursor: pointer; color: #666;
    `;
    closeBtn.onclick = () => document.body.removeChild(modal);

    actions.appendChild(downloadBtn);
    actions.appendChild(closeBtn);
    titleBar.appendChild(title);
    titleBar.appendChild(actions);

    // Ä°Ã§erik alanÄ±
    const container = document.createElement('div');

    const showError = () => {
        container.innerHTML = '';
        const errorMsg = document.createElement('p');
        errorMsg.textContent = 'Belge gÃ¶rÃ¼ntÃ¼lenemiyor. Dosya formatÄ± desteklenmiyor olabilir.';
        errorMsg.style.color = '#ef4444';
        container.appendChild(errorMsg);

        const openNewTab = document.createElement('a');
        openNewTab.href = certificateUrl;
        openNewTab.target = '_blank';
        openNewTab.textContent = 'Yeni sekmede aÃ§';
        openNewTab.style.cssText = 'display:inline-block; margin-top:8px; color:#2563EB;';
        container.appendChild(openNewTab);
    };

    try {
        if (mime === 'application/pdf') {
            // PDF: iframe/embed ile gÃ¶ster
            const iframe = document.createElement('iframe');
            iframe.src = certificateUrl;
            iframe.type = 'application/pdf';
            iframe.style.cssText = 'width:80vw; height:80vh; border:none; border-radius:8px; background:#f9fafb;';
            iframe.onerror = showError;
            container.appendChild(iframe);
        } else if (mime && mime.startsWith('image') || (!mime && isDataUrl && urlLower.startsWith('data:image'))) {
            // Image: img ile gÃ¶ster
            const img = document.createElement('img');
            img.src = certificateUrl;
            img.style.cssText = `
                max-width: 80vw; max-height: 80vh; object-fit: contain;
                border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            `;
            img.onerror = showError;
            container.appendChild(img);
        } else {
            // TÃ¼r tespit edilemediyse PDF olarak dene, olmazsa hata
            const iframe = document.createElement('iframe');
            iframe.src = certificateUrl;
            iframe.type = 'application/pdf';
            iframe.style.cssText = 'width:80vw; height:80vh; border:none; border-radius:8px; background:#f9fafb;';
            iframe.onerror = showError;
            container.appendChild(iframe);
        }
    } catch (e) {
        showError();
    }

    content.appendChild(titleBar);
    content.appendChild(container);
    modal.appendChild(content);
    document.body.appendChild(modal);

    // Arka plana tÄ±klayÄ±nca kapat
    modal.onclick = (e) => {
        if (e.target === modal) document.body.removeChild(modal);
    };
}

                    async function saveUser() {
                        // Ensure Supabase service is initialized
                        if (!supabaseService || !supabaseService.supabase) {
                            console.log('Initializing Supabase service...');
                            if (typeof supabaseService !== 'undefined') {
                                supabaseService.initialize();
                            } else {
                                alert('Supabase servisi mevcut deÄŸil!');
                                return;
                            }
                        }

                        const editingId = document.getElementById('editingUserId').value;
                        const photoFile = document.getElementById('userPhoto').files[0];
                        const certificateFile = document.getElementById('userCertificate').files[0];
                        
                        // Get form data - mapped to actual user_profiles table schema
                        const userData = {
                            full_name: document.getElementById('userFullName').value.trim(),
                            email: document.getElementById('userEmail').value.trim(),
                            username: document.getElementById('userName').value.trim(),
                            role: mapRoleToSchema(document.getElementById('userRole').value || 'user'),
                            tc_no: document.getElementById('userTcNo').value.trim(),
                            birth_date: document.getElementById('userBirthDate').value,
                            phone: document.getElementById('userPhone').value.trim(),
                            branch: document.getElementById('userBranch').value,
                            sport: document.getElementById('userBranch').value, // Map branch to sport field too
                            password: document.getElementById('userPassword').value,
                            is_active: true
                        };

                        // Helper function to map role values to schema
                        function mapRoleToSchema(role) {
                            const roleMap = {
                                'Admin': 'admin',
                                'AntrenÃ¶r': 'coach', 
                                'KullanÄ±cÄ±': 'user'
                            };
                            return roleMap[role] || 'user';
                        }

                        // Remove empty fields to avoid null values
                        Object.keys(userData).forEach(key => {
                            if (userData[key] === '' || userData[key] === null || userData[key] === undefined) {
                                delete userData[key];
                            }
                        });

                        // Handle photo upload if file is selected
                        if (photoFile) {
                            try {
                                const reader = new FileReader();
                                const photoDataUrl = await new Promise((resolve) => {
                                    reader.onload = (e) => resolve(e.target.result);
                                    reader.readAsDataURL(photoFile);
                                });
                                userData.photo_url = photoDataUrl;
                            } catch (error) {
                                console.error('Error processing photo:', error);
                                alert('FotoÄŸraf yÃ¼klenirken hata oluÅŸtu, fotoÄŸraf olmadan devam ediliyor.');
                            }
                        }

                        // Handle certificate upload if file is selected
                        if (certificateFile) {
                            try {
                                const reader = new FileReader();
                                const certificateDataUrl = await new Promise((resolve) => {
                                    reader.onload = (e) => resolve(e.target.result);
                                    reader.readAsDataURL(certificateFile);
                                });
                                userData.certificate_url = certificateDataUrl;
                            } catch (error) {
                                console.error('Error processing certificate:', error);
                                alert('Belge yÃ¼klenirken hata oluÅŸtu, belge olmadan devam ediliyor.');
                            }
                        }

                        // Validation
                        if (!userData.full_name) {
                            alert('Ad Soyad gereklidir!');
                            document.getElementById('userFullName').focus();
                            return;
                        }

                        if (!userData.email) {
                            alert('E-posta gereklidir!');
                            document.getElementById('userEmail').focus();
                            return;
                        }

                        if (!userData.username) {
                            alert('KullanÄ±cÄ± adÄ± gereklidir!');
                            document.getElementById('userName').focus();
                            return;
                        }

                        // TC Kimlik No validation
                        if (userData.tc_no && !validateTCKimlikNo(userData.tc_no)) {
                            alert('GeÃ§ersiz TC Kimlik No! TC Kimlik No 11 haneli olmalÄ± ve geÃ§erli bir numara olmalÄ±dÄ±r.');
                            document.getElementById('userTcNo').focus();
                            return;
                        }

                        if (!editingId && !userData.password) {
                            alert('Yeni kullanÄ±cÄ± iÃ§in ÅŸifre gereklidir!');
                            document.getElementById('userPassword').focus();
                            return;
                        }

                        if (!editingId && userData.password) {
                            const passwordConfirm = document.getElementById('userPasswordConfirm').value;
                            if (userData.password !== passwordConfirm) {
                                alert('Åžifreler eÅŸleÅŸmiyor!');
                                document.getElementById('userPasswordConfirm').focus();
                                return;
                            }
                        }

                        // Hash password if provided
                        if (userData.password) {
                            userData.password = await hashPassword(userData.password);
                        }

                        // Debug: Log the data being sent (without password)
                        const logData = { ...userData };
                        if (logData.password) logData.password = '[HASHED]';
                        console.log('User data to be saved:', logData);

                        try {
                            let result;
                            if (editingId) {
                                // Update existing user
                                // Remove password if empty (don't update password)
                                if (!userData.password) {
                                    delete userData.password;
                                }
                                result = await supabaseService.updateUser(editingId, userData);
                                if (result.success) {
                                    alert('KullanÄ±cÄ± baÅŸarÄ±yla gÃ¼ncellendi!');
                                    clearUserForm();
                                    loadUsers();
                                } else {
                                    alert('KullanÄ±cÄ± gÃ¼ncellenirken hata oluÅŸtu: ' + (result.error || 'Bilinmeyen hata'));
                                }
                            } else {
                                // Create new user
                                result = await supabaseService.createUser(userData);
                                if (result.success) {
                                    alert('KullanÄ±cÄ± baÅŸarÄ±yla eklendi!');
                                    clearUserForm();
                                    loadUsers();
                                } else {
                                    alert('KullanÄ±cÄ± eklenirken hata oluÅŸtu: ' + (result.error || 'Bilinmeyen hata'));
                                }
                            }
                        } catch (error) {
                            console.error('Error saving user:', error);
                            alert('KullanÄ±cÄ± kaydedilirken hata oluÅŸtu!');
                        }
                    }

                    function clearUserForm() {
                        document.getElementById('editingUserId').value = '';
                        document.getElementById('userTcNo').value = '';
                        document.getElementById('userFullName').value = '';
                        document.getElementById('userBirthDate').value = '';
                        document.getElementById('userPhone').value = '';
                        document.getElementById('userEmail').value = '';
                        document.getElementById('userBranch').value = '';
                        document.getElementById('userName').value = '';
                        document.getElementById('userPassword').value = '';
                        document.getElementById('userPasswordConfirm').value = '';
                        document.getElementById('userRole').value = '';
                        document.getElementById('userPhoto').value = '';
                        document.getElementById('userCertificate').value = '';
                    }

                    // Test function to check all users and find yakup
                    async function testYakupUser() {
                        try {
                            console.log('=== TESTING ALL USERS ===');
                            
                            // Get all users to see what's in the table
                            const allResult = await supabaseService.supabase
                                .from('user_profiles')
                                .select('username, email, full_name, is_active, password')
                                .limit(10);
                            
                            console.log('All users in table:', allResult);
                            
                            if (allResult.data && allResult.data.length > 0) {
                                console.log('Found users:');
                                allResult.data.forEach((user, index) => {
                                    console.log(`${index + 1}. Username: "${user.username}", Email: "${user.email}", Full Name: "${user.full_name}", Active: ${user.is_active}, Has Password: ${!!user.password}`);
                                });
                                
                                // Try to find yakup with different variations
                                const yakupVariations = ['yakup', 'Yakup', 'YAKUP'];
                                for (const variation of yakupVariations) {
                                    const found = allResult.data.find(u => u.username === variation);
                                    if (found) {
                                        console.log(`Found yakup as "${variation}":`, found);
                                        break;
                                    }
                                }
                            } else {
                                console.log('No users found in user_profiles table');
                            }
                            
                            // Also try specific yakup search with case insensitive
                            const yakupResult = await supabaseService.supabase
                                .from('user_profiles')
                                .select('*')
                                .ilike('username', 'yakup');
                            
                            console.log('Case insensitive yakup search:', yakupResult);
                            
                        } catch (error) {
                            console.error('Test error:', error);
                        }
                    }

                    // Call test function when page loads
                    window.testYakupUser = testYakupUser;

                    // System Logs Functions
                    let currentLogs = [];

                    async function loadSystemLogs() {
                        try {
                            console.log('Loading system logs from database...');
                            
                            // Ensure Supabase service is initialized
                            if (!supabaseService || !supabaseService.supabase) {
                                console.log('Initializing Supabase service...');
                                if (typeof supabaseService !== 'undefined') {
                                    supabaseService.initialize();
                                } else {
                                    throw new Error('supabaseService not available');
                                }
                            }
                            
                            const result = await supabaseService.getActivityLogs();
                            
                            if (result.success && result.data) {
                                currentLogs = result.data;
                                renderSystemLogs(currentLogs);
                                updateLogsStats(currentLogs);
                            } else {
                                console.error('Error loading logs:', result.error);
                                showLogsError('Sistem loglarÄ± yÃ¼klenirken hata oluÅŸtu.');
                            }
                        } catch (error) {
                            console.error('Error loading logs:', error);
                            showLogsError('Sistem loglarÄ± yÃ¼klenirken hata oluÅŸtu.');
                        }
                    }

                    function renderSystemLogs(logs) {
                        const tableBody = document.getElementById('logsTableBody');
                        
                        if (!logs || logs.length === 0) {
                            tableBody.innerHTML = `
                                <div style="padding: 40px; text-align: center; color: #6b7280;">
                                    <i class="fas fa-clipboard-list" style="font-size: 32px; margin-bottom: 12px; opacity: 0.5;"></i>
                                    <p style="margin: 0; font-size: 14px;">HenÃ¼z sistem logu bulunmuyor.</p>
                                </div>
                            `;
                            return;
                        }
                        // Allowed actions/entity_types
                        const allowedActions = new Set(['create','update','delete','assign','payment','unpay']);
                        const allowedEntities = new Set(['student','training','equipment','payment']);

                        // Filter out login/logout and other noise
                        const filtered = logs.filter(l => allowedActions.has(String(l.action || '').toLowerCase()) && allowedEntities.has(String(l.entity_type || '').toLowerCase()));

                        if (filtered.length === 0) {
                            tableBody.innerHTML = `
                                <div style="padding: 40px; text-align: center; color: #6b7280;">
                                    <i class="fas fa-clipboard-list" style="font-size: 32px; margin-bottom: 12px; opacity: 0.5;"></i>
                                    <p style="margin: 0; font-size: 14px;">Filtreye uygun log bulunmuyor.</p>
                                </div>
                            `;
                            return;
                        }

                        const iconMap = {
                            student: 'fas fa-user-graduate',
                            training: 'fas fa-running',
                            equipment: 'fas fa-tshirt',
                            payment: 'fas fa-credit-card'
                        };

                        const colorMap = {
                            student: { bg: '#EEF2FF', fg: '#4F46E5' },      // indigo
                            training: { bg: '#ECFDF5', fg: '#059669' },     // green
                            equipment: { bg: '#FFF7ED', fg: '#F59E0B' },    // amber
                            payment: { bg: '#F0F9FF', fg: '#0EA5E9' },      // sky
                            default: { bg: '#F3F4F6', fg: '#374151' }       // gray
                        };

                        const actionText = {
                            create: 'Eklendi',
                            update: 'GÃ¼ncellendi',
                            delete: 'Silindi',
                            assign: 'AtandÄ±',
                            payment: 'Ã–deme KaydÄ±',
                            unpay: 'Ã–deme Geri AlÄ±ndÄ±'
                        };

                        const entityText = {
                            student: 'Ã–ÄŸrenci',
                            training: 'Antrenman',
                            equipment: 'Ekipman',
                            payment: 'Ã–deme'
                        };

                        const logsHtml = filtered.map((log, index) => {
                            const isLast = index === filtered.length - 1;
                            const logDate = log.created_at ? new Date(log.created_at).toLocaleString('tr-TR') : new Date().toLocaleString('tr-TR');
                            const action = (log.action || '').toLowerCase();
                            const entityType = (log.entity_type || '').toLowerCase();
                            let details = log.details || '';
                            // Sanitize legacy details
                            details = details.replace(/undefined\s+Ã¶ÄŸrencisine/gi, 'seÃ§ilen Ã¶ÄŸrenciye');
                            let userInfo = log.user_type || log.user_info || log.username || '';
                            if (!userInfo || userInfo === 'Sistem') {
                                try {
                                    if (window.app && window.app.currentUser) {
                                        const u = window.app.currentUser;
                                        userInfo = u.full_name || u.username || u.email || 'KullanÄ±cÄ±';
                                    }
                                } catch(_) {}
                            }
                            const icon = iconMap[entityType] || 'fas fa-info-circle';
                            const entityLabel = entityText[entityType] || (entityType.charAt(0).toUpperCase() + entityType.slice(1));
                            const title = `${entityLabel} ${actionText[action] || ''}`.trim();
                            const colors = colorMap[entityType] || colorMap.default;
                            
                            return `
                                <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; ${isLast ? '' : 'border-bottom: 1px solid #e5e7eb'};">
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <div style="width: 36px; height: 36px; border-radius: 8px; background: ${colors.bg}; display: flex; align-items: center; justify-content: center; color: ${colors.fg};">
                                            <i class="${icon}"></i>
                                        </div>
                                        <div>
                                            <div style="font-weight: 600; color: #111827;">${title}</div>
                                            ${details ? `<div style=\"color: #6b7280; font-size: 12px;\">${details}</div>` : ''}
                                            <div style="color: #6b7280; font-size: 12px; display: flex; align-items: center; gap: 4px;">
                                                <i class="fas fa-user" style="font-size: 10px;"></i>
                                                ${userInfo || '-'}
                                            </div>
                                        </div>
                                    </div>
                                    <div style="color: #6b7280; font-size: 12px; text-align: right;">
                                        ${logDate}
                                    </div>
                                </div>
                            `;
                        }).join('');

                        tableBody.innerHTML = logsHtml;
                    }

                    function getActionInfo(action, entityType, details) {
                        // Resimdeki Ã¶rneklere gÃ¶re TÃ¼rkÃ§e mesajlar
                        const sampleMessages = [
                            'kadÄ±n futbol antrenmanÄ± eklendi',
                            'Bilinmeyen kullanÄ±cÄ±sÄ± silindi',
                            'kadÄ±n futbol antrenmanÄ± silindi',
                            'Yakup BaÅŸtÃ¼rk (AntrenÃ¶r) kullanÄ±cÄ±sÄ± gÃ¼ncellendi',
                            'Hasan Tirtom Ã¶ÄŸrenci kaydÄ± geri alÄ±ndÄ±'
                        ];

                        let actionInfo = {
                            badge: 'DIÄžER',
                            color: '#6b7280',
                            text: 'Sistem iÅŸlemi gerÃ§ekleÅŸtirildi'
                        };

                        // Detaylar varsa kullan, yoksa genel mesaj oluÅŸtur
                        if (details && details.trim() !== '') {
                            actionInfo.text = details;
                        } else {
                            // Action ve entity type'a gÃ¶re TÃ¼rkÃ§e mesaj oluÅŸtur
                            const entityMap = {
                                'student': 'Ã¶ÄŸrenci',
                                'user': 'kullanÄ±cÄ±',
                                'training': 'antrenman',
                                'equipment': 'ekipman',
                                'payment': 'Ã¶deme'
                            };

                            const entity = entityMap[entityType] || 'kayÄ±t';

                            switch(action) {
                                case 'create':
                                    actionInfo.text = `Yeni ${entity} eklendi`;
                                    actionInfo.badge = 'OLUÅžTUR';
                                    actionInfo.color = '#10b981';
                                    break;
                                case 'update':
                                    actionInfo.text = `${entity.charAt(0).toUpperCase() + entity.slice(1)} gÃ¼ncellendi`;
                                    actionInfo.badge = 'GÃœNCELLE';
                                    actionInfo.color = '#f59e0b';
                                    break;
                                case 'delete':
                                    actionInfo.text = `${entity.charAt(0).toUpperCase() + entity.slice(1)} silindi`;
                                    actionInfo.badge = 'SÄ°L';
                                    actionInfo.color = '#ef4444';
                                    break;
                                case 'login':
                                    actionInfo.text = 'Sisteme giriÅŸ yapÄ±ldÄ±';
                                    actionInfo.badge = 'GÄ°RÄ°Åž';
                                    actionInfo.color = '#3b82f6';
                                    break;
                                case 'logout':
                                    actionInfo.text = 'Sistemden Ã§Ä±kÄ±ÅŸ yapÄ±ldÄ±';
                                    actionInfo.badge = 'Ã‡IKIÅž';
                                    actionInfo.color = '#6b7280';
                                    break;
                                default:
                                    // Rastgele Ã¶rnek mesaj seÃ§
                                    actionInfo.text = sampleMessages[Math.floor(Math.random() * sampleMessages.length)];
                                    break;
                            }
                        }

                        return actionInfo;
                    }

                    function getUserInfo(userType, userRole, userId) {
    // EÄŸer kullanÄ±cÄ± bilgisi yoksa
    if (!userType && !userRole && !userId) {
        return 'Sistem (Otomatik Ä°ÅŸlem)';
    }

    // KullanÄ±cÄ± tipi ve rolÃ¼ iÃ§in daha anlaÅŸÄ±lÄ±r isimler
    const roleMap = {
        'admin': 'YÃ¶netici',
        'coach': 'AntrenÃ¶r',
        'user': 'KullanÄ±cÄ±',
        'YÃ¶netici': 'YÃ¶netici',
        'AntrenÃ¶r': 'AntrenÃ¶r',
        'KullanÄ±cÄ±': 'KullanÄ±cÄ±',
        'system': 'Sistem',
        'admin@admin.com': 'Admin (YÃ¶netici)',
        'coach@example.com': 'AntrenÃ¶r (VarsayÄ±lan)'
    };

    // EÄŸer userType bir e-posta adresi ise, sadece kullanÄ±cÄ± adÄ±nÄ± al
    let displayName = userType || 'Bilinmeyen';
    if (userType && userType.includes('@')) {
        displayName = userType.split('@')[0];
    }

    // Rol bilgisini daha anlaÅŸÄ±lÄ±r hale getir
    let displayRole = roleMap[userRole] || roleMap[userType] || 'KullanÄ±cÄ±';
    
    // EÄŸer userType bir e-posta adresi deÄŸilse ve rol bilgisi yoksa
    if (!userType.includes('@') && !roleMap[userType]) {
        // EÄŸer userType boÅŸ deÄŸilse, onu kullan
        if (userType && userType.trim() !== '') {
            return `${userType}`;
        }
        return 'Sistem';
    }

    // EÄŸer kullanÄ±cÄ± adÄ± ve rol aynÄ±ysa sadece birini gÃ¶ster
    if (displayName === displayRole) {
        return displayName;
    }

    return `${displayName} (${displayRole})`;
}

                    function updateLogsStats(logs) {
                        const totalCount = logs ? logs.length : 0;
                        const lastUpdate = logs && logs.length > 0 ? 
                            new Date(logs[0].created_at).toLocaleString('tr-TR') : 
                            new Date().toLocaleString('tr-TR');

                        document.getElementById('totalLogsCount').textContent = totalCount;
                        document.getElementById('lastUpdateTime').textContent = lastUpdate;
                    }

                    function showLogsError(message) {
                        const tableBody = document.getElementById('logsTableBody');
                        tableBody.innerHTML = `
                            <div style="padding: 40px; text-align: center; color: #ef4444;">
                                <i class="fas fa-exclamation-triangle" style="font-size: 32px; margin-bottom: 12px;"></i>
                                <p style="margin: 0; font-size: 14px;">${message}</p>
                            </div>
                        `;
                    }

                    async function refreshLogs() {
                        await loadSystemLogs();
                    }

                    async function clearAllLogs() {
                        if (!confirm('TÃ¼m sistem loglarÄ±nÄ± silmek istediÄŸinizden emin misiniz? Bu iÅŸlem geri alÄ±namaz.')) {
                            return;
                        }

                        try {
                            const result = await supabaseService.clearActivityLogs();
                            
                            if (result.success) {
                                alert('TÃ¼m sistem loglarÄ± baÅŸarÄ±yla temizlendi.');
                                await loadSystemLogs();
                            } else {
                                alert('Loglar temizlenirken hata oluÅŸtu: ' + (result.error || 'Bilinmeyen hata'));
                            }
                        } catch (error) {
                            console.error('Error clearing logs:', error);
                            alert('Loglar temizlenirken hata oluÅŸtu.');
                        }
                    }

                    // Data Management Functions
                    function openPasswordChangeModal() {
                        document.getElementById('passwordChangeModal').style.display = 'flex';
                        // Set current username if available
                        const currentUser = getCurrentUser();
                        if (currentUser) {
                            document.getElementById('changeUsername').value = currentUser.username || '';
                        }
                    }

                    function closePasswordChangeModal() {
                        document.getElementById('passwordChangeModal').style.display = 'none';
                        document.getElementById('passwordChangeForm').reset();
                    }

                    function getCurrentUser() {
                        // Get current user from session or local storage
                        const userStr = localStorage.getItem('currentUser');
                        return userStr ? JSON.parse(userStr) : null;
                    }

                    // Password change form handler
                    document.addEventListener('DOMContentLoaded', function() {
                        const passwordForm = document.getElementById('passwordChangeForm');
                        if (passwordForm) {
                            passwordForm.addEventListener('submit', async function(e) {
                                e.preventDefault();
                                
                                const username = document.getElementById('changeUsername').value.trim();
                                const newPassword = document.getElementById('newPassword').value;
                                const confirmPassword = document.getElementById('confirmNewPassword').value;
                                
                                // Validation
                                if (!username) {
                                    alert('KullanÄ±cÄ± adÄ± gereklidir.');
                                    return;
                                }
                                
                                if (!newPassword) {
                                    alert('Yeni ÅŸifre gereklidir.');
                                    return;
                                }
                                
                                if (newPassword.length < 6) {
                                    alert('Åžifre en az 6 karakter olmalÄ±dÄ±r.');
                                    return;
                                }
                                
                                if (newPassword !== confirmPassword) {
                                    alert('Åžifreler eÅŸleÅŸmiyor.');
                                    return;
                                }
                                
                                try {
                                    // Hash the password
                                    const hashedPassword = await hashPassword(newPassword);
                                    
                                    // Update password in database
                                    const result = await supabaseService.updateUserPassword(username, hashedPassword);
                                    
                                    if (result.success) {
                                        alert('Åžifre baÅŸarÄ±yla gÃ¼ncellendi.');
                                        closePasswordChangeModal();
                                        
                                        // Add activity log
                                        await supabaseService.addActivityLog('update', 'user', null, `${username} kullanÄ±cÄ±sÄ±nÄ±n ÅŸifresi gÃ¼ncellendi`);
                                    } else {
                                        alert('Åžifre gÃ¼ncellenirken hata oluÅŸtu: ' + (result.error || 'Bilinmeyen hata'));
                                    }
                                } catch (error) {
                                    console.error('Password change error:', error);
                                    alert('Åžifre gÃ¼ncellenirken hata oluÅŸtu.');
                                }
                            });
                        }

                        // Close modal handlers
                        const closePasswordBtn = document.getElementById('closePasswordModal');
                        if (closePasswordBtn) {
                            closePasswordBtn.addEventListener('click', closePasswordChangeModal);
                        }
                    });

                    async function hashPassword(password) {
                        const encoder = new TextEncoder();
                        const data = encoder.encode(password);
                        const hash = await crypto.subtle.digest('SHA-256', data);
                        return Array.from(new Uint8Array(hash))
                            .map(b => b.toString(16).padStart(2, '0'))
                            .join('');
                    }

                    async function backupData(event) {
    try {
        const confirmed = confirm('TÃ¼m sistem verilerini yedeklemek istediÄŸinizden emin misiniz?');
        if (!confirmed) return;

        // Show loading
        const button = event ? event.target : document.querySelector('[onclick="backupData()"]');
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Yedekleniyor...';
        button.disabled = true;

        // Get all data from tables
        const tables = ['user_profiles', 'students', 'sport_branches', 'trainings', 'equipment_types', 'payments', 'activity_logs'];
        const backupData = {
            timestamp: new Date().toISOString(),
            version: '1.0',
            data: {}
        };

        for (const table of tables) {
            try {
                const result = await supabaseService.getAllFromTable(table);
                if (result.success) {
                    backupData.data[table] = result.data;
                }
            } catch (error) {
                console.warn(`Could not backup table ${table}:`, error);
            }
        }

        // Create and download backup file
        const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `atkoy-backup-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        alert('Veri yedeÄŸi baÅŸarÄ±yla oluÅŸturuldu ve indirildi.');
        
        // Add activity log (basit versiyon)
        try {
            await supabaseService.addActivityLog('backup', 'system', null, 'Sistem verileri yedeklendi');
        } catch (logError) {
            console.warn('Activity log could not be added:', logError);
        }

    } catch (error) {
        console.error('Backup error:', error);
        alert('Yedekleme sÄ±rasÄ±nda hata oluÅŸtu.');
    } finally {
        // Reset button
        const button = event ? event.target : document.querySelector('[onclick="backupData()"]');
        if (button) {
            button.innerHTML = '<i class="fas fa-download"></i> Veri Yedekle';
            button.disabled = false;
        }
    }
}

                    function restoreData() {
                        const input = document.createElement('input');
                        input.type = 'file';
                        input.accept = '.json';
                        input.onchange = async function(e) {
                            const file = e.target.files[0];
                            if (!file) return;

                            try {
                                const confirmed = confirm('UYARI: Bu iÅŸlem mevcut tÃ¼m verileri silecek ve yedek dosyasÄ±ndaki verilerle deÄŸiÅŸtirecektir. Devam etmek istediÄŸinizden emin misiniz?');
                                if (!confirmed) return;

                                const text = await file.text();
                                const backupData = JSON.parse(text);

                                if (!backupData.data) {
                                    alert('GeÃ§ersiz yedek dosyasÄ± formatÄ±.');
                                    return;
                                }

                                // Restore data table by table
                                for (const [table, data] of Object.entries(backupData.data)) {
                                    if (data && data.length > 0) {
                                        try {
                                            await supabaseService.restoreTableData(table, data);
                                        } catch (error) {
                                            console.warn(`Could not restore table ${table}:`, error);
                                        }
                                    }
                                }

                                alert('Veriler baÅŸarÄ±yla geri yÃ¼klendi. Sayfa yeniden yÃ¼klenecek.');
                                
                                // Add activity log
                                await supabaseService.addActivityLog('restore', 'system', null, 'Sistem verileri geri yÃ¼klendi');
                                
                                // Reload page
                                window.location.reload();

                            } catch (error) {
                                console.error('Restore error:', error);
                                alert('Geri yÃ¼kleme sÄ±rasÄ±nda hata oluÅŸtu: ' + error.message);
                            }
                        };
                        input.click();
                    }

                    async function clearAllData() {
                        const confirmed = confirm('UYARI: Bu iÅŸlem TÃœM sistem verilerini kalÄ±cÄ± olarak silecektir. Bu iÅŸlem GERÄ° ALINAMAZ!\n\nDevam etmek iÃ§in "TÃ¼m verileri sil" yazÄ±n:');
                        if (!confirmed) return;

                        const verification = prompt('Onaylamak iÃ§in "TÃ¼m verileri sil" yazÄ±n:');
                        if (verification !== 'TÃ¼m verileri sil') {
                            alert('Ä°ÅŸlem iptal edildi.');
                            return;
                        }

                        try {
                            // Show loading
                            const originalText = event.target.innerHTML;
                            event.target.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Siliniyor...';
                            event.target.disabled = true;

                            // Clear all tables
                            const tables = ['activity_logs', 'payments', 'equipment', 'trainings', 'students', 'sport_branches'];
                            
                            for (const table of tables) {
                                try {
                                    await supabaseService.clearTable(table);
                                } catch (error) {
                                    console.warn(`Could not clear table ${table}:`, error);
                                }
                            }

                            alert('TÃ¼m veriler baÅŸarÄ±yla silindi. Sayfa yeniden yÃ¼klenecek.');
                            
                            // Reload page
                            window.location.reload();

                        } catch (error) {
                            console.error('Clear data error:', error);
                            alert('Veri silme sÄ±rasÄ±nda hata oluÅŸtu.');
                        } finally {
                            // Reset button
                            event.target.innerHTML = originalText;
                            event.target.disabled = false;
                        }
                    }
                </script>
                </script>
            </main>
        </div>
    </div>

    <!-- Student Form Modal -->
    <div id="studentModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Yeni Ã–ÄŸrenci Ekle</h3>
                <button id="closeModal" class="close-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="studentFormContent">
                <!-- Student form will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Student Detail Modal -->
    <div id="studentDetailModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ã–ÄŸrenci DetaylarÄ±</h3>
                <button id="closeDetailModal" class="close-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="studentDetailContent">
                <!-- Student details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Password Change Modal -->
    <div id="passwordChangeModal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 style="color: #dc2626; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-key"></i>
                    Åžifre DeÄŸiÅŸtir
                </h3>
                <button id="closePasswordModal" class="close-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div style="padding: 25px;">
                <form id="passwordChangeForm">
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 8px; font-size: 14px;">
                            KullanÄ±cÄ± AdÄ±
                        </label>
                        <input type="text" id="changeUsername" placeholder="KullanÄ±cÄ± adÄ±nÄ±zÄ± girin" style="
                            width: 100%; 
                            padding: 12px 16px; 
                            border: 2px solid #e2e8f0; 
                            border-radius: 8px; 
                            font-size: 14px; 
                            background: white;
                            transition: all 0.3s ease;
                        " onfocus="this.style.borderColor='#dc2626'; this.style.boxShadow='0 0 0 3px rgba(220, 38, 38, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 8px; font-size: 14px;">
                            Yeni Åžifre
                        </label>
                        <input type="password" id="newPassword" placeholder="Yeni ÅŸifrenizi girin" style="
                            width: 100%; 
                            padding: 12px 16px; 
                            border: 2px solid #e2e8f0; 
                            border-radius: 8px; 
                            font-size: 14px; 
                            background: white;
                            transition: all 0.3s ease;
                        " onfocus="this.style.borderColor='#dc2626'; this.style.boxShadow='0 0 0 3px rgba(220, 38, 38, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                    </div>
                    
                    <div style="margin-bottom: 25px;">
                        <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 8px; font-size: 14px;">
                            Yeni Åžifre Tekrar
                        </label>
                        <input type="password" id="confirmNewPassword" placeholder="Yeni ÅŸifrenizi tekrar girin" style="
                            width: 100%; 
                            padding: 12px 16px; 
                            border: 2px solid #e2e8f0; 
                            border-radius: 8px; 
                            font-size: 14px; 
                            background: white;
                            transition: all 0.3s ease;
                        " onfocus="this.style.borderColor='#dc2626'; this.style.boxShadow='0 0 0 3px rgba(220, 38, 38, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                    </div>
                    
                    <div style="display: flex; gap: 15px; justify-content: flex-end;">
                        <button type="button" onclick="closePasswordChangeModal()" style="
                            background: #6b7280; 
                            color: white; 
                            border: none; 
                            padding: 12px 24px; 
                            border-radius: 8px; 
                            font-weight: 600; 
                            cursor: pointer; 
                            font-size: 14px; 
                            transition: all 0.3s ease;
                        " onmouseover="this.style.background='#4b5563'" onmouseout="this.style.background='#6b7280'">
                            Ä°ptal
                        </button>
                        <button type="submit" style="
                            background: linear-gradient(135deg, #dc2626, #b91c1c); 
                            color: white; 
                            border: none; 
                            padding: 12px 24px; 
                            border-radius: 8px; 
                            font-weight: 600; 
                            cursor: pointer; 
                            font-size: 14px; 
                            display: flex; 
                            align-items: center; 
                            gap: 8px;
                            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
                            transition: all 0.3s ease;
                        " onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 6px 20px rgba(220, 38, 38, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(220, 38, 38, 0.3)'">
                            <i class="fas fa-save"></i>
                            Åžifre GÃ¼ncelle
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Supabase CDN - iOS Safari Compatible -->
    <script src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.js" defer></script>
    
    <!-- Supabase Configuration -->
    <script src="supabase-config.js" defer></script>
    <script src="supabase-service.js" defer></script>
    
    <!-- Main Application -->
    <script src="app.js" defer></script>
    
    <script>
        // iOS Safari Error Handling
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
            if (e.error && e.error.message && e.error.message.includes('supabase')) {
                console.error('Supabase related error detected');
            }
        });
        
        window.addEventListener('unhandledrejection', function(e) {
            console.error('Unhandled promise rejection:', e.reason);
        });
        
        // Supabase'i baÅŸlat
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                const initialized = initSupabase();
                if (initialized) {
                    await supabaseService.initialize();
                    console.log('Supabase service initialized successfully');
                }
            } catch (error) {
                console.error('Initialization error:', error);
            }
        });
    </script>
</body>
</html>
